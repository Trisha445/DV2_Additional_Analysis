<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Enhanced dashboard with complete annotations and fixed UX - Oct 21, 2025 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Labour Market Analysis - Week 9 & Week 10</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Georgia:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Georgia', serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header .description {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .content {
            padding: 40px;
        }

        .visualization-section {
            margin-bottom: 50px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            color: #2d3436;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-badge {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }

        .chart-container:hover {
            transform: translateY(-5px);
        }

        .chart-description {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #00b894;
        }

        .chart-description h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .chart-description p {
            color: #636e72;
            margin-bottom: 10px;
        }

    /* Improve readability: limit text width to ~60-70 chars and increase paragraph spacing */
    .description, .chart-description p {
      max-width: 60ch;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.5;
    }
    .lead-story {
      font-size: 1rem;
      color: #334155;
      max-width: 58ch;
      line-height: 1.5;
      margin-top: 0.4rem;
    }

    /* HD Visual Enhancements */
    .chart-card {
        background: white;
        border-radius: 20px;
        padding: 35px;
        margin-bottom: 35px;
        box-shadow: 0 12px 35px rgba(0,0,0,0.08), 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
        overflow: hidden;
    }

    .chart-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 45px rgba(0,0,0,0.12), 0 8px 25px rgba(0,0,0,0.08);
    }

    .chart-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #1d4ed8 0%, #059669 100%);
    }

    .chart-title {
        font-size: 1.6rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 15px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .chart-description-text {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        padding: 20px 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        border: 1px solid #e2e8f0;
    }

    .chart-description-text p {
        color: #475569;
        line-height: 1.6;
        margin: 0;
        font-size: 15px;
    }

    .chart-caption {
        text-align: center;
        font-size: 14px;
        color: #64748b;
        font-weight: 600;
        margin-top: 20px;
        padding: 15px 20px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 12px;
        border: 2px solid #e2e8f0;
        letter-spacing: 0.3px;
    }

    .chart-figure {
        position: relative;
        min-height: 450px;
        border-radius: 12px;
        overflow: hidden;
    }

    /* Enhanced dropdown styling */
    select {
        padding: 10px 15px !important;
        border-radius: 10px !important;
        border: 2px solid #e2e8f0 !important;
        background: white !important;
        font-size: 14px !important;
        font-weight: 500 !important;
        color: #334155 !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06) !important;
    }

    select:focus {
        outline: none !important;
        border-color: #1d4ed8 !important;
        box-shadow: 0 4px 12px rgba(29, 78, 216, 0.15) !important;
    }

    select:hover {
        border-color: #cbd5e1 !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
    }

        .features-grid {
            display: grid;
      grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
    /* allow specific cards to span full width (two columns) on desktop */
    .chart-card.full-width { grid-column: 1 / -1; }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #fd79a8;
        }

        .feature-card h4 {
            color: #2d3436;
            margin-bottom: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            color: #636e72;
            font-size: 0.9rem;
        }

        .insights-section {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 40px;
        }

        .insights-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .insight-item h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .data-sources {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .responsive-container {
            width: 100%;
            overflow-x: hidden;
            overflow-y: visible;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Vega-Lite tooltip styling */
        .vega-tooltip {
            font-family: 'Inter', sans-serif !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            border: 1px solid #ddd !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(10px) !important;
        }

        .vega-tooltip-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 4px !important;
        }

    /* Smooth heatmap fade for filter transitions */
    #heatmap-unemployment-vis { transition: opacity 300ms ease; }

        .vega-tooltip table {
            font-size: 13px !important;
        }

        .vega-tooltip td.key {
            font-weight: 600 !important;
            color: #34495e !important;
            padding-right: 12px !important;
        }

        .vega-tooltip td.value {
            font-weight: 500 !important;
            color: #2c3e50 !important;
        }
    /* Dashboard grid & card refinements for HD layout */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* show 2 per row for demo */
      gap: 24px;
      align-items: start;
      justify-items: center;
    }

    .chart-card, .feature-card {
      background: linear-gradient(180deg, #ffffff 0%, #fbfbfd 100%);
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 12px 30px rgba(17,24,39,0.06);
      transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 360px;
      min-width: 340px;
      border: 1px solid rgba(0,0,0,0.06); /* subtle card border for separation */
    }

    .chart-card:hover, .feature-card:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow: 0 20px 40px rgba(17,24,39,0.12);
    }

    .chart-title {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.6rem;
    }

    .chart-figure {
      flex: 1 1 auto;
      display:block;
      min-height: 240px;
    }

    .chart-annotation {
      margin-top: 0.8rem;
      font-size: 0.95rem;
      color: #475569;
      background: rgba(15,23,42,0.02);
      padding: 0.6rem 0.8rem;
      border-radius: 0.5rem;
    }

    /* fade-in when charts load */
    .chart-loaded { animation: chartFadeIn 420ms ease both; }
    @keyframes chartFadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 1100px) {
      .charts-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 640px) {
      .charts-grid { grid-template-columns: 1fr; }
      .chart-card { padding: 1rem; }
    }
    /* Map hero styles: large centered map area for HD layout */
    .map-hero {
      width: 100%;
      max-width: 1100px;
      min-height: 430px;
      margin: 12px auto;
      border-radius: 1rem;
      box-shadow: 0 18px 40px rgba(17,24,39,0.08);
      overflow: hidden;
      background: #ffffff;
      padding: 8px;
      border: 1px solid rgba(0,0,0,0.04);
      position: relative; /* allow absolute overlay inside */
    }
    /* Smooth SVG transitions and subtle glow on hover for map geoshapes */
    #map-vis svg path {
      transition: stroke-width 180ms ease, stroke 180ms ease, filter 220ms ease, opacity 160ms ease;
    }
    #map-vis svg path:hover {
      filter: drop-shadow(0 6px 12px rgba(60,120,140,0.08));
      stroke-width: 1.6px !important;
      stroke: rgba(33, 37, 41, 0.18) !important; /* much lighter subtle border */
    }
    /* Map overlay annotations placed inside whitespace of card */
    .map-annotations {
      position: absolute;
      bottom: 14px;
      left: 18px;
      background: rgba(255,255,255,0.96);
      padding: 10px 12px;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(17,24,39,0.10);
      font-size: 13px;
      color: #0f172a;
      line-height: 1.28;
      max-width: 42%;
      border: 1px solid rgba(15,23,42,0.04);
      z-index: 40;
    }
    .map-annotations div { margin-bottom: 6px; }
    .map-annot-title { font-weight:700; font-size:14px; margin-bottom:6px; }
    .map-annot-line { font-size:13px; color:#102a43; }
    .map-annot-swatches { display:flex; gap:10px; margin-top:6px; align-items:center; }
    .map-swatch { display:flex; gap:6px; align-items:center; font-size:12px; color:#102a43; }
    .swatch-box { width:14px; height:14px; display:inline-block; border-radius:2px; }
  .swatch-box.high { background: #1d4ed8; } /* high swatch (blue) */
  .swatch-box.medium { background: #60a5fa; } /* medium swatch (light blue) */
  .swatch-box.low { background: #fde68a; } /* low swatch (light yellow) */
    @media (max-width: 900px) {
      .map-annotations { max-width: 60%; font-size: 12px; bottom: 12px; left: 12px; }
    }
    @media (max-width: 560px) {
      .map-annotations { position: relative; bottom: auto; left: auto; width: calc(100% - 24px); max-width: none; margin: 12px; }
      .map-hero { padding: 6px; }
      .map-annot-swatches { gap: 8px; }
    }
    </style>
</head>
<body>
    <script>
      // Defensive helpers: some older code expected showLoading/hideLoading globally.
      // These safely no-op if the related DOM elements don't exist to avoid "reading 'style' of null" errors.
      function showLoading(msg) {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return; // gracefully return when missing
          el.style.display = 'block';
          if (msg) el.textContent = msg;
        } catch (e) {
          console.warn('showLoading error (ignored):', e && e.message);
        }
      }

      function hideLoading() {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return;
          el.style.display = 'none';
        } catch (e) {
          console.warn('hideLoading error (ignored):', e && e.message);
        }
      }
    </script>
    <div class="container">
        <div class="header">
            <h1>🇦🇺 Australian Labour Market Analysis</h1>
      <div class="subtitle">Comprehensive Spatial and Statistical Visualization</div>
      <div class="description story-intro">
        Visual exploration of Australia's labour market dynamics.<br>
        Employment patterns across states and territories revealed.<br>
        Navigate charts to discover regional economic insights.
      </div>
        </div>

    <!-- Global loading indicator used by some scripts (hidden by default) -->
    <div id="global-loading" style="display:none; position: fixed; right: 18px; top: 18px; background: rgba(0,0,0,0.8); color: #fff; padding: 10px 14px; border-radius: 8px; font-size: 0.95rem; z-index: 9999;">Loading…</div>

        <div class="content">
            <!-- Story 1: Geographic Overview (Map First) -->
            <div class="visualization-section" style="margin-bottom: 25px;">
                <div class="chart-container">
                  <div class="chart-card full-width">
                    <div class="chart-title">🗺️ Geographic Employment Distribution</div>
                    <div class="chart-description-text">
                      <p>Employment rates across Australian states show regional patterns.<br>
                      Geographic concentrations reveal workforce distribution nationwide.</p>
                    </div>
                    <div class="responsive-container">
                      <div class="map-hero">
                        <div id="map-vis" style="width:100%; height:100%; min-height:430px;"></div>
                        <div class="map-annotations" aria-hidden="false">
                          <div class="map-annot-title">Employment insights</div>
                          <div class="map-annot-line">Highest: ACT — 67.2%</div>
                          <div class="map-annot-line">Lowest: SA — 59.8%</div>
                          <div class="map-annot-line">Median: ~63%</div>
                          <div class="map-annot-swatches" aria-hidden="true" role="presentation">
                            <div class="map-swatch"><span class="swatch-box high"></span><span class="swatch-label">High</span></div>
                            <div class="map-swatch"><span class="swatch-box medium"></span><span class="swatch-label">Medium</span></div>
                            <div class="map-swatch"><span class="swatch-box low"></span><span class="swatch-label">Low</span></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="chart-caption" style="text-align: center; font-size: 14px; color: #64748b; font-weight: 500; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #059669;">
                      🗺️ Employment rates vary significantly across Australia states.
                    </div>
                    
                    <!-- Key Insights to Fill Whitespace -->
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%); border-radius: 8px; border-left: 3px solid #10b981;">
                      <p style="margin: 0; font-size: 13px; color: #065f46; font-weight: 500;">💡 <strong>Geographic Insight:</strong> ACT leads at 67.2% employment rate.<br>Eastern states show concentrated economic activity patterns.</p>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Story 2: Employment-Wage Correlation (Scatter Plot Second) -->
            <div class="visualization-section" style="margin-bottom: 25px;">
                <div class="chart-container">
                  <div class="chart-card full-width">
                    <div class="chart-title">📈 Employment vs Wage Index Relationship</div>
                    <div class="chart-description-text">
                      <p>Employment rates versus wage indices correlation analysis.<br>
                      Economic performance patterns across Australian states revealed.</p>
                    </div>
                    
                    <div class="responsive-container">
                      <div id="scatter-vis" style="width: 100%; min-height: 650px; overflow: visible;"></div>
                    </div>
                    <div class="chart-caption" style="text-align: center; font-size: 14px; color: #64748b; font-weight: 500; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #dc2626;">
                      📈 Strong positive correlation between employment rates and wage growth across most states.
                    </div>
                    
                    <!-- Economic Insights -->
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; border-left: 3px solid #0ea5e9;">
                      <p style="margin: 0; font-size: 13px; color: #0c4a6e; font-weight: 500;">📊 <strong>Economic Pattern:</strong> Resource states achieve high wages.<br>Government centers show strong employment correlation.</p>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Story 3: Market Opportunities -->
            <div class="visualization-section" style="margin-bottom: 25px;">
                <div class="chart-container">
                  <div class="chart-card full-width">
                    <div class="chart-title">💼 Job Market Opportunities by State</div>
                    <div class="chart-description-text">
                      <p>Job vacancy rankings reveal employment opportunity concentration.<br>
                      Regional career prospects across Australian states shown.</p>
                    </div>
                    
                    <div style="display:flex; gap:12px; align-items:center; margin-bottom:10px;">
                      <label style="font-weight:600; font-size:13px;">Wage Growth:</label>
                      <select id="vacancies-wage-select" style="padding:6px; border-radius:6px; border:1px solid #e2e8f0;">
                        <option value="All">All Growth Rates</option>
                        <option value="High Growth">High Growth</option>
                        <option value="Moderate Growth">Moderate Growth</option>
                      </select>
                    </div>
                    <div id="vacancies-vis" class="chart-figure"></div>

                    <div class="chart-caption" style="text-align: center; font-size: 14px; color: #64748b; font-weight: 500; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #1d4ed8;">
                      💼 Eastern states dominate opportunities. NSW leads with 1.14M vacancies.
                    </div>
                    
                    <!-- Market Insights -->
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; border-left: 3px solid #0284c7;">
                      <p style="margin: 0; font-size: 13px; color: #0369a1; font-weight: 500;">💡 <strong>Market Dynamics:</strong> Top three states control 78% of vacancies.<br>Population density drives economic diversification advantages.</p>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Story 4: Performance Analysis -->
            <div class="visualization-section" style="margin-bottom: 25px;">
                <div class="chart-container">
                  <div class="chart-card full-width">
                    <div class="chart-title">🎯 State Performance Intersection Analysis</div>
                    <div class="chart-description-text">
                      <p>State clusters by employment and wage patterns.<br>
                      Bubble size indicates economic magnitude per state.</p>
                    </div>
                    
                    <div style="display:flex; gap:15px; align-items:center; margin-bottom:15px; flex-wrap: wrap;">
                      <label style="font-weight:600; font-size:13px; color:#334155;">Bubble Size Based On:</label>
                      <select id="bubble-size-select" style="padding:8px 12px; border-radius:8px; border:2px solid #e2e8f0; background:white; font-size:13px; min-width:160px;">
                        <option value="Labour_Force">Labour Force</option>
                        <option value="Job_Vacancies">Job Vacancies</option>
                        <option value="Employment_Rate">Employment Rate</option>
                      </select>
                    </div>
                    <div style="position: relative;">
                      <!-- State Performance Bubble Map -->
                      <div id="state-performance-bubblemap" class="chart-figure"></div>
                      
                      <!-- Performance Annotation in Bottom Right -->
                      <div style="position: absolute; bottom: 20px; right: 20px; width: 280px; padding: 12px; background: rgba(248, 250, 252, 0.95); border-radius: 8px; border-left: 4px solid #8b5cf6; backdrop-filter: blur(4px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                        <p style="margin: 0; font-size: 11px; color: #6d28d9; font-weight: 600; line-height: 1.3;">
                          🎯 <strong>Performance Tiers:</strong><br>
                          Elite: ACT, WA, NT (high employment + wages)<br>  
                          Balanced: NSW, VIC, QLD (steady performance)<br>
                          Developing: SA, TAS (growth opportunities)
                        </p>
                      </div>
                    </div>

                    <div class="chart-caption" style="text-align: center; font-size: 14px; color: #64748b; font-weight: 500; margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                      🎯 Three performance clusters: Elite, Balanced, and Developing states.
                    </div>
                    
                    <!-- Clustering Insights -->
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #fef7ff 0%, #fae8ff 100%); border-radius: 8px; border-left: 3px solid #a855f7;">
                      <p style="margin: 0; font-size: 13px; color: #9333ea; font-weight: 500;">🔬 <strong>Performance Clustering:</strong> Resource states form elite performance cluster.<br>Manufacturing transition creates distinct regional disparities.</p>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Story 5: Workforce Composition (Donut + Complementary Chart) -->
            <div class="visualization-section" style="margin-bottom: 25px;">
                <div class="chart-container">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; align-items: start;">
                    
                    <!-- Donut Chart -->
                    <div class="chart-card" style="margin: 0;">
                      <div class="chart-title" style="font-size: 1.3rem;">📊 Workforce Distribution</div>
                      <div class="chart-description-text">
                        <p>Labour force by employment performance categories.<br>
                        Worker proportions across different economic conditions.</p>
                      </div>
                      <div id="donut-distribution-vis" class="chart-figure" style="min-height: 350px;"></div>
                      


                      <div class="chart-caption" style="text-align: center; font-size: 12px; color: #64748b; font-weight: 500; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #059669;">
                        📊 85.9% of workers in average-performing states - significant opportunity for improvement.
                      </div>
                    </div>

                    <!-- Complementary Chart: Economic Performance Ranking -->
                    <div class="chart-card" style="margin: 0;">
                      <div class="chart-title" style="font-size: 1.3rem;">💰 Wage Performance Leaders</div>
                      <div class="chart-description-text">
                        <p>States ranked by wage index performance levels.<br>
                        Regions with strongest compensation growth highlighted.</p>
                      </div>
                      <div id="wage-performance-vis" class="chart-figure" style="min-height: 350px;"></div>
                      
                      <div class="chart-caption" style="text-align: center; font-size: 12px; color: #64748b; font-weight: 500; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #f59e0b;">
                        💰 WA leads at 153.7, followed by ACT (152.9) and NT (152.4).
                      </div>
                    </div>

                  </div>

                  <!-- Dashboard Summary Insights -->
                  <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 15px 0; color: #1e293b; font-size: 18px; font-weight: 700; text-align: center;">📊 Key Dashboard Insights</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                      <div style="padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #059669;">
                        <strong style="color: #065f46;">Regional Leadership:</strong> ACT leads employment. WA dominates wages.
                      </div>
                      <div style="padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #dc2626;">
                        <strong style="color: #991b1b;">Economic Correlation:</strong> Employment and wage growth show positive correlation.
                      </div>
                      <div style="padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #0284c7;">
                        <strong style="color: #0369a1;">Market Concentration:</strong> Eastern states control 78% of opportunities.
                      </div>
                      <div style="padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #7c3aed;">
                        <strong style="color: #6d28d9;">Performance Tiers:</strong> Three clusters: Elite, Balanced, and Developing.
                      </div>
                    </div>
                  </div>

                </div>
            </div>

    <!-- Chart 1: Job Vacancies Analysis -->
    <script type="application/json" id="vacancies-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Job Vacancies by State Analysis",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": "container",
      "height": 450,
      "params": [
        { "name": "wageGrowthFilter", "value": "All" },
        {
          "name": "hover",
          "select": {"type": "point", "on": "mouseover"}
        }
      ],
      "transform": [
        { "filter": "datum.Job_Vacancies > 0" },
        {
          "calculate": "datum.State == 'New South Wales' || datum.State == 'Victoria' || datum.State == 'Queensland' ? 'Top 3' : 'Other'",
          "as": "highlight"
        },
        { "filter": "wageGrowthFilter == 'All' || datum.Wage_Growth_Category == wageGrowthFilter" }
      ],
      "mark": { 
        "type": "bar", 
        "cornerRadius": 10,
        "stroke": "white",
        "strokeWidth": 2,
        "cursor": "pointer"
      },
      "encoding": {
        "x": { 
          "field": "State", 
          "type": "nominal", 
          "sort": {"field": "Job_Vacancies", "order": "descending"}, 
          "axis": { 
            "labelAngle": -45, 
            "labelFontSize": 12,
            "titleFontSize": 14,
            "title": "Australian States & Territories",
            "grid": false,
            "labelPadding": 8
          }
        },
        "y": { 
          "field": "Job_Vacancies", 
          "type": "quantitative", 
          "title": "Job Vacancies (Thousands)",
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "grid": true,
            "gridOpacity": 0.4,
            "gridColor": "#e2e8f0"
          }
        },
        "color": {
          "field": "highlight",
          "type": "nominal",
          "scale": {
            "domain": ["Top 3", "Other"],
            "range": ["#1e40af", "#bfdbfe"]
          },
          "legend": {
            "title": "Vacancy Ranking",
            "titleFontSize": 13,
            "labelFontSize": 12,
            "orient": "top-right"
          }
        },
        "opacity": {
          "condition": {"param": "hover", "value": 1.0},
          "value": 0.85
        },
        "stroke": {
          "condition": {"param": "hover", "value": "#1e40af"},
          "value": "white"
        },
        "strokeWidth": {
          "condition": {"param": "hover", "value": 3},
          "value": 2
        },
        "tooltip": [
          { 
            "field": "State", 
            "type": "nominal", 
            "title": "State"
          },
          { 
            "field": "Job_Vacancies", 
            "type": "quantitative", 
            "title": "Job Vacancies", 
            "format": ",.0f"
          },
          { 
            "field": "Job_Vacancy_Rate", 
            "type": "quantitative", 
            "title": "Vacancy Rate (%)", 
            "format": ".1f"
          },
          { 
            "field": "highlight", 
            "type": "nominal", 
            "title": "Ranking"
          }
        ]
      },
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white",
        "axis": { 
          "labelColor": "#374151",
          "titleColor": "#1f2937",
          "gridColor": "#f3f4f6"
        }
      }
    }
    </script>

    <!-- Chart 2: Economic Trends Analysis -->
    <script type="application/json" id="radar-performance-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Economic Performance Trends Analysis",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": "container",
      "height": 450,
      "params": [
        { "name": "highlightState", "value": "All" },
        {
          "name": "hover",
          "select": {"type": "point", "on": "mouseover"}
        }
      ],
      "transform": [
        {
          "fold": ["Employment_Rate", "Participation_Rate", "WageIndex", "Job_Vacancy_Rate"],
          "as": ["metric", "value"]
        },
        {
          "calculate": "datum.metric == 'Employment_Rate' ? 'Employment Rate' : datum.metric == 'Participation_Rate' ? 'Participation Rate' : datum.metric == 'WageIndex' ? 'Wage Index' : 'Vacancy Rate'",
          "as": "metric_label"
        }
      ],
      "mark": {
        "type": "line",
        "strokeWidth": 3,
        "point": {
          "filled": true,
          "size": 80
        },
        "cursor": "pointer"
      },
      "encoding": {
        "x": {
          "field": "metric_label",
          "type": "nominal",
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Economic Indicators",
            "labelAngle": -20,
            "labelPadding": 10,
            "titlePadding": 15
          }
        },
        "y": {
          "field": "value",
          "type": "quantitative",
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Performance Value",
            "grid": true,
            "gridOpacity": 0.3
          }
        },
        "color": {
          "field": "State",
          "type": "nominal",
          "scale": {
            "domain": ["New South Wales", "Victoria", "Queensland", "Western Australia", "South Australia", "Tasmania", "Australian Capital Territory", "Northern Territory"],
            "range": ["#dc2626", "#ea580c", "#d97706", "#ca8a04", "#65a30d", "#16a34a", "#059669", "#0d9488"]
          },
          "legend": {
            "title": "Australian States",
            "titleFontSize": 12,
            "labelFontSize": 11,
            "orient": "right",
            "columns": 1
          }
        },
        "opacity": {
          "condition": [
            {"test": "highlightState == 'All'", "value": 0.8},
            {"test": "datum.State == highlightState", "value": 1.0}
          ],
          "value": 0.2
        },
        "strokeWidth": {
          "condition": [
            {"test": "highlightState == 'All'", "value": 3},
            {"test": "datum.State == highlightState", "value": 5}
          ],
          "value": 2
        },
        "tooltip": [
          { "field": "State", "type": "nominal", "title": "State" },
          { "field": "metric_label", "type": "nominal", "title": "Metric" },
          { "field": "value", "type": "quantitative", "title": "Value", "format": ".1f" },
          { "field": "Economic_Performance_Score", "type": "quantitative", "title": "Overall Score", "format": ".1f" }
        ]
      },
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white",
        "axis": {
          "labelColor": "#374151",
          "titleColor": "#1f2937"
        }
      }
    }
    </script>

    <!-- Chart 3: State Performance Bubble Map -->
    <script type="application/json" id="efficiency-matrix-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "State Performance Bubble Map",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": "container",
      "height": 450,
      "params": [
        { "name": "bubbleSize", "value": "Labour_Force" },
        {
          "name": "hover",
          "select": {"type": "point", "on": "mouseover"}
        }
      ],
      "transform": [
        {
          "calculate": "bubbleSize == 'Labour_Force' ? datum.Labour_Force : bubbleSize == 'Job_Vacancies' ? datum.Job_Vacancies : datum.Employment_Rate",
          "as": "size_value"
        },
        {
          "calculate": "datum.Employment_Category == 'Average' && datum.Wage_Growth_Category == 'Moderate Growth' ? (datum.State == 'New South Wales' ? 0 : datum.State == 'Victoria' ? 0.3 : datum.State == 'Western Australia' ? -0.3 : 0.15) : 0",
          "as": "x_jitter"
        },
        {
          "calculate": "datum.Employment_Category == 'Average' && datum.Wage_Growth_Category == 'Moderate Growth' ? (datum.State == 'New South Wales' ? 0 : datum.State == 'Victoria' ? 0.15 : datum.State == 'Western Australia' ? -0.15 : -0.3) : datum.Employment_Category == 'Below Average' && datum.Wage_Growth_Category == 'High Growth' ? (datum.State == 'South Australia' ? 0.1 : -0.1) : 0",
          "as": "y_jitter"
        }
      ],
      "mark": {
        "type": "circle",
        "stroke": "white",
        "strokeWidth": 3,
        "cursor": "pointer",
        "opacity": 0.85
      },
      "encoding": {
        "x": {
          "field": "Employment_Category",
          "type": "nominal",
          "scale": {"padding": 0.5},
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Employment Performance Category",
            "labelAngle": 0,
            "labelPadding": 10,
            "titlePadding": 15,
            "grid": true,
            "gridOpacity": 0.2
          }
        },
        "xOffset": {
          "field": "x_jitter",
          "type": "quantitative",
          "scale": {"range": [-30, 30]}
        },
        "y": {
          "field": "Wage_Growth_Category", 
          "type": "nominal",
          "scale": {"padding": 0.5},
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Wage Growth Category",
            "labelPadding": 10,
            "titlePadding": 15,
            "grid": true,
            "gridOpacity": 0.2
          }
        },
        "yOffset": {
          "field": "y_jitter",
          "type": "quantitative",
          "scale": {"range": [-20, 20]}
        },
        "size": {
          "field": "size_value",
          "type": "quantitative",
          "scale": {"range": [200, 2500]},
          "legend": {
            "title": {"expr": "bubbleSize == 'Labour_Force' ? 'Labour Force Size' : bubbleSize == 'Job_Vacancies' ? 'Job Vacancies' : 'Employment Rate (%)'"},
            "titleFontSize": 12,
            "labelFontSize": 10,
            "orient": "right",
            "offset": 10
          }
        },
        "color": {
          "field": "State",
          "type": "nominal",
          "scale": {
            "domain": ["New South Wales", "Victoria", "Queensland", "Western Australia", "South Australia", "Tasmania", "Australian Capital Territory", "Northern Territory"],
            "range": ["#dc2626", "#ea580c", "#d97706", "#ca8a04", "#65a30d", "#16a34a", "#059669", "#0d9488"]
          },
          "legend": {
            "title": "Australian States & Territories",
            "titleFontSize": 12,
            "labelFontSize": 10,
            "orient": "right",
            "columns": 1
          }
        },
        "opacity": {
          "condition": {"param": "hover", "value": 1.0},
          "value": 0.8
        },
        "stroke": {
          "condition": {"param": "hover", "value": "#1f2937"},
          "value": "white"
        },
        "strokeWidth": {
          "condition": {"param": "hover", "value": 4},
          "value": 3
        },
        "tooltip": [
          { "field": "State", "type": "nominal", "title": "State" },
          { "field": "Employment_Category", "type": "nominal", "title": "Employment Category" },
          { "field": "Wage_Growth_Category", "type": "nominal", "title": "Wage Growth Category" },
          { "field": "Labour_Force", "type": "quantitative", "title": "Labour Force", "format": ",.0f" },
          { "field": "Job_Vacancies", "type": "quantitative", "title": "Job Vacancies", "format": ",.0f" },
          { "field": "Economic_Performance_Score", "type": "quantitative", "title": "Performance Score", "format": ".1f" },
          { "field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)", "format": ".1f" },
          { "field": "WageIndex", "type": "quantitative", "title": "Wage Index", "format": ".1f" }
        ]
      },
      "resolve": {
        "scale": {
          "x": "independent",
          "y": "independent"
        }
      },
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white",
        "axis": {
          "labelColor": "#374151",
          "titleColor": "#1f2937",
          "gridColor": "#f3f4f6"
        }
      }
    }
    </script>

    <!-- State Performance Bubble Map - Inline Specification -->
    <script type="application/json" id="state-performance-bubblemap-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "State Performance Bubble Map - Employment vs Wage Growth Analysis",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": 650,
      "height": 480,
      "padding": {
        "left": 80,
        "right": 200,
        "top": 30,
        "bottom": 80
      },
      "params": [
        { "name": "bubbleSize", "value": "Labour_Force" },
        {
          "name": "hover",
          "select": {"type": "point", "on": "mouseover"}
        }
      ],
      "transform": [
        {
          "calculate": "bubbleSize == 'Labour_Force' ? datum.Labour_Force : bubbleSize == 'Job_Vacancies' ? datum.Job_Vacancies : datum.Employment_Rate",
          "as": "size_value"
        },
        {
          "calculate": "datum.Employment_Category == 'Average' && datum.Wage_Growth_Category == 'Moderate Growth' ? (datum.State == 'New South Wales' ? 0 : datum.State == 'Victoria' ? 0.3 : datum.State == 'Western Australia' ? -0.3 : 0.15) : 0",
          "as": "x_jitter"
        },
        {
          "calculate": "datum.Employment_Category == 'Average' && datum.Wage_Growth_Category == 'Moderate Growth' ? (datum.State == 'New South Wales' ? 0 : datum.State == 'Victoria' ? 0.15 : datum.State == 'Western Australia' ? -0.15 : -0.3) : datum.Employment_Category == 'Below Average' && datum.Wage_Growth_Category == 'High Growth' ? (datum.State == 'South Australia' ? 0.1 : -0.1) : 0",
          "as": "y_jitter"
        }
      ],
      "mark": {
        "type": "circle",
        "stroke": "white",
        "strokeWidth": 3,
        "cursor": "pointer",
        "opacity": 0.85
      },
      "encoding": {
        "x": {
          "field": "Employment_Category",
          "type": "nominal",
          "scale": {"padding": 0.5},
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Employment Performance Category",
            "labelAngle": 0,
            "labelPadding": 15,
            "titlePadding": 25,
            "grid": true,
            "gridOpacity": 0.4,
            "gridColor": "#e2e8f0",
            "gridWidth": 1,
            "gridDash": [3, 3],
            "domain": true,
            "domainColor": "#374151",
            "domainWidth": 2,
            "tickColor": "#6b7280",
            "tickSize": 8
          }
        },
        "xOffset": {
          "field": "x_jitter",
          "type": "quantitative",
          "scale": {"range": [-30, 30]}
        },
        "y": {
          "field": "Wage_Growth_Category", 
          "type": "nominal",
          "scale": {"padding": 0.5},
          "axis": {
            "titleFontSize": 14,
            "labelFontSize": 12,
            "title": "Wage Growth Category",
            "labelPadding": 15,
            "titlePadding": 25,
            "grid": true,
            "gridOpacity": 0.4,
            "gridColor": "#e2e8f0",
            "gridWidth": 1,
            "gridDash": [3, 3],
            "domain": true,
            "domainColor": "#374151",
            "domainWidth": 2,
            "tickColor": "#6b7280",
            "tickSize": 8
          }
        },
        "yOffset": {
          "field": "y_jitter",
          "type": "quantitative",
          "scale": {"range": [-20, 20]}
        },
        "size": {
          "field": "size_value",
          "type": "quantitative",
          "scale": {"range": [200, 2500]},
          "legend": {
            "title": {"expr": "bubbleSize == 'Labour_Force' ? 'Labour Force Size' : bubbleSize == 'Job_Vacancies' ? 'Job Vacancies' : 'Employment Rate (%)'"},
            "titleFontSize": 12,
            "labelFontSize": 10,
            "orient": "right",
            "offset": 15,
            "titleLimit": 150,
            "labelLimit": 100
          }
        },
        "color": {
          "field": "State",
          "type": "nominal",
          "scale": {
            "domain": ["New South Wales", "Victoria", "Queensland", "Western Australia", "South Australia", "Tasmania", "Australian Capital Territory", "Northern Territory"],
            "range": ["#dc2626", "#ea580c", "#d97706", "#ca8a04", "#65a30d", "#16a34a", "#059669", "#0d9488"]
          },
          "legend": {
            "title": "Australian States & Territories",
            "titleFontSize": 12,
            "labelFontSize": 10,
            "orient": "right",
            "columns": 1,
            "offset": 15,
            "titleLimit": 150,
            "labelLimit": 120,
            "symbolType": "circle",
            "symbolSize": 100
          }
        },
        "opacity": {
          "condition": {"param": "hover", "value": 1.0},
          "value": 0.8
        },
        "stroke": {
          "condition": {"param": "hover", "value": "#1f2937"},
          "value": "white"
        },
        "strokeWidth": {
          "condition": {"param": "hover", "value": 4},
          "value": 3
        },
        "tooltip": [
          { "field": "State", "type": "nominal", "title": "State" },
          { "field": "Employment_Category", "type": "nominal", "title": "Employment Category" },
          { "field": "Wage_Growth_Category", "type": "nominal", "title": "Wage Growth Category" },
          { "field": "Labour_Force", "type": "quantitative", "title": "Labour Force", "format": ",.0f" },
          { "field": "Job_Vacancies", "type": "quantitative", "title": "Job Vacancies", "format": ",.0f" },
          { "field": "Economic_Performance_Score", "type": "quantitative", "title": "Performance Score", "format": ".1f" },
          { "field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)", "format": ".1f" },
          { "field": "WageIndex", "type": "quantitative", "title": "Wage Index", "format": ".1f" }
        ]
      },
      "resolve": {
        "scale": {
          "x": "independent",
          "y": "independent"
        }
      },
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white",
        "axis": {
          "labelColor": "#374151",
          "titleColor": "#1f2937",
          "gridColor": "#f3f4f6"
        },
        "legend": {
          "labelLimit": 0,
          "titleLimit": 0
        }
      }
    }
    </script>

    <!-- Chart 4: Labour Force Distribution Donut Chart -->
    <script type="application/json" id="donut-distribution-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Labour Force Distribution by Employment Category",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": "container",
      "height": 320,
      "transform": [
        {
          "aggregate": [
            {"op": "sum", "field": "Labour_Force", "as": "total_labour_force"},
            {"op": "count", "as": "state_count"},
            {"op": "mean", "field": "Economic_Performance_Score", "as": "avg_performance"}
          ],
          "groupby": ["Employment_Category"]
        },
        {
          "calculate": "datum.total_labour_force / 13542000 * 100",
          "as": "percentage"
        }
      ],
      "layer": [
        {
          "mark": {
            "type": "arc",
            "innerRadius": 70,
            "outerRadius": 140,
            "stroke": "white",
            "strokeWidth": 3,
            "cornerRadius": 5
          },
          "encoding": {
            "theta": {
              "field": "total_labour_force",
              "type": "quantitative",
              "title": "Labour Force"
            },
            "color": {
              "field": "Employment_Category",
              "type": "nominal",
              "scale": {
                "domain": ["Below Average", "Average", "Above Average"],
                "range": ["#0ea5e9", "#8b5cf6", "#059669"]
              },
              "legend": {
                "title": "Employment Performance Category",
                "titleFontSize": 13,
                "labelFontSize": 11,
                "orient": "bottom",
                "symbolSize": 200,
                "padding": 10
              }
            },
            "tooltip": [
              { "field": "Employment_Category", "type": "nominal", "title": "Employment Category" },
              { "field": "total_labour_force", "type": "quantitative", "title": "Total Labour Force", "format": ",.0f" },
              { "field": "percentage", "type": "quantitative", "title": "Percentage of Total", "format": ".1f" },
              { "field": "state_count", "type": "quantitative", "title": "Number of States" },
              { "field": "avg_performance", "type": "quantitative", "title": "Avg Performance Score", "format": ".1f" }
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "fontSize": 14,
            "fontWeight": "bold",
            "color": "#1f2937"
          },
          "encoding": {
            "text": {"value": ["Australian", "Labour Force", "by Category"]}
          }
        }
      ],
      "resolve": {"scale": {"color": "independent"}},
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white",
        "legend": {
          "orient": "top-right",
          "direction": "vertical", 
          "titleLimit": 200,
          "labelLimit": 150,
          "titleColor": "#111827",
          "labelColor": "#374151",
          "titleFontWeight": 600,
          "offset": 10,
          "padding": 8
        }
      }
    }
    </script>

    <!-- Chart 5: Wage Performance Leaders - Horizontal Lollipop Chart -->
    <script type="application/json" id="wage-performance-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "States ranked by Wage Index - Horizontal Lollipop Chart",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": "container",
      "height": 320,
      "transform": [
        { "filter": "datum.WageIndex > 0" },
        {
          "aggregate": [
            {"op": "mean", "field": "WageIndex", "as": "avg_wage_index"}
          ],
          "groupby": ["State"]
        },
        {
          "window": [{"op": "rank", "as": "rank"}],
          "sort": [{"field": "avg_wage_index", "order": "descending"}]
        },
        {
          "calculate": "150.8",
          "as": "national_avg"
        }
      ],
      "layer": [
        {
          "description": "National average reference line",
          "mark": {
            "type": "rule",
            "color": "#94a3b8",
            "strokeWidth": 1.5,
            "strokeDash": [4, 4],
            "opacity": 0.8
          },
          "encoding": {
            "x": {
              "field": "national_avg",
              "type": "quantitative"
            }
          }
        },
        {
          "description": "Lollipop sticks",
          "mark": {
            "type": "rule",
            "color": "#cbd5e1",
            "strokeWidth": 2,
            "opacity": 0.7
          },
          "encoding": {
            "y": {
              "field": "State",
              "type": "nominal",
              "sort": {"field": "avg_wage_index", "order": "descending"},
              "axis": {
                "labelColor": "#374151",
                "titleColor": "#1f2937",
                "labelFontWeight": 500,
                "title": null,
                "labelLimit": 120
              }
            },
            "x": {
              "field": "avg_wage_index",
              "type": "quantitative",
              "scale": {"zero": false, "nice": true},
              "axis": {
                "labelColor": "#374151",
                "titleColor": "#1f2937",
                "grid": true,
                "gridColor": "#f1f5f9",
                "gridOpacity": 0.8,
                "title": "Wage Index Level"
              }
            },
            "x2": {"value": 0}
          }
        },
        {
          "description": "Lollipop circles",
          "mark": {
            "type": "circle",
            "size": 120,
            "stroke": "white",
            "strokeWidth": 2,
            "cursor": "pointer"
          },
          "encoding": {
            "y": {
              "field": "State",
              "type": "nominal",
              "sort": {"field": "avg_wage_index", "order": "descending"}
            },
            "x": {
              "field": "avg_wage_index",
              "type": "quantitative",
              "scale": {"zero": false, "nice": true}
            },
            "color": {
              "field": "rank",
              "type": "ordinal",
              "scale": {
                "range": ["#dc2626", "#f97316", "#eab308", "#84cc16", "#22c55e", "#06b6d4", "#3b82f6", "#8b5cf6"]
              },
              "legend": {
                "title": "Performance Rank",
                "orient": "bottom",
                "direction": "horizontal",
                "titleColor": "#111827",
                "labelColor": "#374151",
                "titleFontWeight": 600,
                "labelFontWeight": 500,
                "symbolSize": 80,
                "offset": 10,
                "padding": 8
              }
            },
            "tooltip": [
              { "field": "State", "type": "nominal", "title": "State" },
              { "field": "avg_wage_index", "type": "quantitative", "title": "Wage Index", "format": ".1f" },
              { "field": "rank", "type": "ordinal", "title": "National Rank" }
            ]
          }
        },
        {
          "description": "National average label",
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "bottom",
            "dx": 5,
            "dy": -5,
            "fontSize": 10,
            "color": "#64748b",
            "fontWeight": 500
          },
          "encoding": {
            "x": {
              "field": "national_avg",
              "type": "quantitative"
            },
            "y": {"value": 15},
            "text": {"value": "Avg: 150.8"}
          }
        }
      ],
      "resolve": {
        "scale": {
          "color": "independent"
        }
      },
      "config": {
        "view": { "stroke": "transparent" },
        "background": "white"
      }
    }
    </script>

  <script>
    // Dynamically load and embed selected Vega(-Lite) JSON specs after DOM is ready.
    (function() {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM ready — starting chart embedding');

        // Target charts to embed for storytelling dashboard
        // Using inline specs for better performance and consistency
        const chartsToLoad = [
          {id: 'scatter-vis', specId: 'week10-scatter-spec'},
          {id: 'vacancies-vis', specId: 'vacancies-spec'},
          {id: 'efficiency-matrix-vis', specId: 'efficiency-matrix-spec'},
          {id: 'donut-distribution-vis', specId: 'donut-distribution-spec'},
          {id: 'wage-performance-vis', specId: 'wage-performance-spec'}
        ];

        chartsToLoad.forEach(function(chart) {
          console.log('Attempting to load', chart.file || ('inline spec ' + chart.specId), 'into', chart.id);
          embedChart(chart);
        });

        function embedChart(chart) {
          const id = chart.id;
          const container = document.getElementById(id);
          if (!container) {
            console.warn('Container not found for', id);
            return;
          }

          // If inline spec provided, use it
          if (chart.specId) {
            try {
              const scriptEl = document.getElementById(chart.specId);
              if (!scriptEl) throw new Error('Inline spec element not found: ' + chart.specId);
              const jsonText = scriptEl.textContent.trim();
              if (!jsonText) throw new Error('Inline spec is empty: ' + chart.specId);
              const spec = JSON.parse(jsonText);
              console.log('Parsed inline spec', chart.specId, ' — embedding now');
              
              // Use appropriate padding for each chart type to ensure full axis visibility
              let padding;
              if (chart.specId === 'week10-scatter-spec') {
                padding = {left: 80, right: 180, top: 50, bottom: 80}; // Enhanced scatter plot padding
              } else if (chart.specId === 'state-performance-bubblemap-spec') {
                padding = {left: 80, right: 220, top: 40, bottom: 80}; // Enhanced bubble chart padding
              } else {
                padding = {left: 25, right: 25, top: 25, bottom: 25}; // Standard padding for other charts
              }
              
              vegaEmbed('#' + id, spec, { theme: 'googlecharts', renderer: 'canvas', actions: {export: false, source: false, compiled: false, editor: false}, padding: padding })
                .then(function(result) { 
                  document.getElementById(id).classList.add('chart-loaded'); 
                  try { document.getElementById(id).__vega_view = result.view; } catch(e){} 
                  
                  // Store views globally for parameter updates
                  if (id === 'scatter-vis') {
                    window.scatterView = result.view;
                    // Setup scatter plot filter controls
                    setTimeout(function() {
                      const updateFilters = function() {
                        const employmentFilter = document.getElementById('employment-filter')?.value || 'All';
                        const wageGrowthFilter = document.getElementById('wage-growth-filter')?.value || 'All';
                        const economicScore = parseInt(document.getElementById('economic-score-slider')?.value || 30);
                        
                        // Update score display
                        const scoreValue = document.getElementById('score-value');
                        if (scoreValue) scoreValue.textContent = economicScore;
                        
                        // Update Vega-Lite parameters
                        if (window.scatterView) {
                          window.scatterView.signal('employmentCategoryFilter', employmentFilter);
                          window.scatterView.signal('wageGrowthFilter', wageGrowthFilter);
                          window.scatterView.signal('economicScoreSlider', economicScore);
                          window.scatterView.run();
                        }
                      };
                      
                      // Attach event listeners to manual controls
                      const empFilter = document.getElementById('employment-filter');
                      const wageFilter = document.getElementById('wage-growth-filter');
                      const scoreSlider = document.getElementById('economic-score-slider');
                      
                      if (empFilter) empFilter.addEventListener('change', updateFilters);
                      if (wageFilter) wageFilter.addEventListener('change', updateFilters);
                      if (scoreSlider) scoreSlider.addEventListener('input', updateFilters);
                    }, 500);
                  } else if (id === 'vacancies-vis') {
                    window.vacanciesView = result.view;
                  } else if (id === 'radar-performance-vis') {
                    window.radarPerformanceView = result.view;
                  } else if (id === 'efficiency-matrix-vis') {
                    window.matrixView = result.view;
                    console.log('🎯 Bubble chart (efficiency-matrix-vis) loaded successfully and view stored');
                  }
                  
                  console.log('✅ Embedded inline', chart.specId, 'into', id); 
                })
                .catch(function(err) { 
                  if (chart.specId === 'efficiency-matrix-spec') {
                    console.error('🔥 BUBBLE CHART EMBED FAILED:', err.message);
                    console.error('🔥 Full error:', err);
                    container.innerHTML = '<div style="color:#dc2626; padding:20px; text-align:center; border:2px solid #fca5a5; border-radius:8px; background:#fef2f2;"><strong>🚨 Bubble Chart Loading Error</strong><br><small>' + err.message + '</small><br><button onclick="window.location.reload()" style="margin-top:10px; padding:5px 15px; background:#dc2626; color:white; border:none; border-radius:4px; cursor:pointer;">Reload</button></div>';
                  } else {
                    let errorMsg = 'Error embedding chart: ' + err.message;
                    if (chart.specId === 'week10-scatter-spec') {
                      errorMsg = 'Scatter plot temporarily unavailable. Check data connection.';
                    }
                    container.innerHTML = '<div style="color:#e74c3c; padding:18px; text-align:center; border:1px solid #fca5a5; border-radius:8px; background:#fef2f2;"><strong>⚠️ ' + errorMsg + '</strong><br><small>Spec ID: ' + chart.specId + '</small></div>';
                  }
                  console.error('Embed error for inline', chart.specId, err); 
                });
              return;
            } catch (err) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Inline spec error:</strong> '+err.message+'</div>';
              console.warn('Inline spec error for', chart.specId, err);
              return;
            }
          }

          // Otherwise fetch the JSON spec
          const file = chart.file;
          fetch(file).then(function(resp) {
            if (!resp.ok) throw new Error('HTTP ' + resp.status + ' ' + resp.statusText);
            const ct = resp.headers.get('content-type') || '';
            // If the server returned HTML (e.g. an error page or redirected HTML), fail fast with useful message
            if (ct.indexOf('text/html') !== -1) throw new Error('Unexpected HTML response (Content-Type: ' + ct + '). The file path may be wrong or GitHub Pages served an error page.');
            return resp.text();
          }).then(function(text) {
            const trimmed = text.trim();
            console.debug('Fetched', file, 'length:', trimmed.length, 'sample:', trimmed.slice(0,200));
            if (!trimmed) throw new Error('Empty file');

            // attempt to extract JSON from HTML wrappers (some assets were wrapped in <script> blocks)
            let jsonText = trimmed;
            const scriptMatch = trimmed.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
            if (scriptMatch) jsonText = scriptMatch[1];

            let spec;
            try {
              spec = JSON.parse(jsonText);
            } catch (err) {
              // Provide a clearer error when the text begins with '<' which commonly indicates HTML
              if (jsonText.trim().charAt(0) === '<') {
                throw new Error('Invalid JSON: file appears to contain HTML/markup. This often happens if the asset path is wrong or GitHub Pages returned an HTML error page.');
              }
              // Try to pull JSON out of an application/json script block if present
              const jsonBlockMatch = trimmed.match(/<script[^>]+type="application\/json"[^>]*>([\s\S]*?)<\/script>/i);
              if (jsonBlockMatch) {
                try { spec = JSON.parse(jsonBlockMatch[1]); }
                catch (innerErr) { throw innerErr; }
              } else {
                throw err; // rethrow original JSON parse error
              }
            }

            console.log('Parsed spec for', file, ' — embedding now');

            vegaEmbed('#' + id, spec, {
              theme: 'googlecharts', renderer: 'canvas',
              actions: {export: false, source: false, compiled: false, editor: false},
              padding: {left:18, right:18, top:18, bottom:18}
            }).then(function(result) {
              // Add loaded class for animation
              const el = document.getElementById(id);
              if (el) { el.classList.add('chart-loaded'); try { el.__vega_view = result.view; } catch(e){} }
              console.log('✅ Embedded', file, 'into', id);
            }).catch(function(embedErr) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Error embedding:</strong> '+embedErr.message+'</div>';
              console.error('Embed error for', file, embedErr);
            });

          }).catch(function(fetchErr) {
            container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Could not load chart file:</strong> '+fetchErr.message+'</div>';
            console.warn('Could not load', file, fetchErr);
          });
        }
        
        // Add state-performance-bubblemap to the charts loading array
        const bubbleChart = {id: 'state-performance-bubblemap', specId: 'state-performance-bubblemap-spec'};
        chartsToLoad.push(bubbleChart);
        
        // Load the bubble chart using the same embedChart function
        embedChart(bubbleChart);
        
        // Setup bubble size selector integration for the inline bubble chart
        setTimeout(function() {
          const sizeSelector = document.getElementById('bubble-size-select');
          const container = document.getElementById('state-performance-bubblemap');
          if (sizeSelector && container && container.__vega_view) {
            sizeSelector.addEventListener('change', function() {
              const selectedSize = this.value;
              container.__vega_view.signal('bubbleSize', selectedSize).run();
              console.log('🎯 Bubble size updated to:', selectedSize);
            });
          }
        }, 1000); // Wait for chart to load
      });
    })();
  </script>

    <script type="application/json" id="week10-scatter-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Employment Rate vs Wage Index Analysis",
        "subtitle": "Multi-channel encoding: Position (Employment vs Wages), Size (Job Vacancies), Color (Economic Performance) | Use filters below to explore data",
        "fontSize": 16,
        "subtitleFontSize": 12,
        "color": "#000000",
        "subtitleColor": "#333333",
        "anchor": "start"
      },
      "params": [
        {
          "name": "employmentCategoryFilter",
          "bind": {
            "input": "select",
            "options": ["All", "Above Average", "Average", "Below Average"],
            "name": "Employment Category Filter: "
          },
          "value": "All"
        },
        {
          "name": "economicScoreSlider",
          "bind": {
            "input": "range",
            "min": 30,
            "max": 65,
            "step": 5,
            "name": "Minimum Economic Performance Score: "
          },
          "value": 30
        },
        {
          "name": "wageGrowthFilter",
          "bind": {
            "input": "select",
            "options": ["All", "High Growth", "Moderate Growth"],
            "name": "Wage Growth Category Filter: "
          },
          "value": "All"
        }
      ],
      "width": 750,
      "height": 550,
      "padding": {
        "left": 80,
        "right": 140,
        "top": 60,
        "bottom": 120
      },
      "data": {
        "values": [
          {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Unemployment_Rate": 4.1, "Participation_Rate": 64.5, "Labour_Force": 2618000, "Population": 5156000, "WageIndex": 149.5, "WageGrowthRate": 2.48, "Employment_to_Wage_Ratio": 41.405, "Job_Vacancies": 63356, "Job_Vacancy_Rate": 24.2, "Economic_Performance_Score": 62.6, "Employment_Category": "Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Unemployment_Rate": 2.8, "Participation_Rate": 69.1, "Labour_Force": 230000, "Population": 431000, "WageIndex": 152.9, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 43.95, "Job_Vacancies": 7291, "Job_Vacancy_Rate": 31.7, "Economic_Performance_Score": 60.0, "Employment_Category": "Above Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Unemployment_Rate": 4.3, "Participation_Rate": 62.5, "Labour_Force": 864000, "Population": 1771000, "WageIndex": 148.2, "WageGrowthRate": 2.45, "Employment_to_Wage_Ratio": 40.351, "Job_Vacancies": 18490, "Job_Vacancy_Rate": 21.4, "Economic_Performance_Score": 44.5, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Unemployment_Rate": 3.0, "Participation_Rate": 65.3, "Labour_Force": 1391000, "Population": 2667000, "WageIndex": 153.7, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.249, "Job_Vacancies": 44651, "Job_Vacancy_Rate": 32.1, "Economic_Performance_Score": 37.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Unemployment_Rate": 3.7, "Participation_Rate": 65.5, "Labour_Force": 134000, "Population": 249000, "WageIndex": 152.4, "WageGrowthRate": 2.16, "Employment_to_Wage_Ratio": 41.404, "Job_Vacancies": 3926, "Job_Vacancy_Rate": 29.3, "Economic_Performance_Score": 36.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Unemployment_Rate": 3.9, "Participation_Rate": 61.1, "Labour_Force": 276000, "Population": 542000, "WageIndex": 147.6, "WageGrowthRate": 2.43, "Employment_to_Wage_Ratio": 39.77, "Job_Vacancies": 5465, "Job_Vacancy_Rate": 19.8, "Economic_Performance_Score": 34.6, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Unemployment_Rate": 3.2, "Participation_Rate": 65.0, "Labour_Force": 4105000, "Population": 8166000, "WageIndex": 150.8, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.645, "Job_Vacancies": 116992, "Job_Vacancy_Rate": 28.5, "Economic_Performance_Score": 33.3, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Unemployment_Rate": 3.4, "Participation_Rate": 65.3, "Labour_Force": 3387000, "Population": 6681000, "WageIndex": 150.3, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 41.983, "Job_Vacancies": 90772, "Job_Vacancy_Rate": 26.8, "Economic_Performance_Score": 31.1, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"}
        ]
      },
      "transform": [
        {
          "filter": "employmentCategoryFilter == 'All' || datum.Employment_Category == employmentCategoryFilter"
        },
        {
          "filter": "datum.Economic_Performance_Score >= economicScoreSlider"
        },
        {
          "filter": "wageGrowthFilter == 'All' || datum.Wage_Growth_Category == wageGrowthFilter"
        }
      ],
      "layer": [
        {
            "mark": {
            "type": "circle",
            "stroke": "#6b7280",
            "strokeWidth": 1,
            "opacity": 0.8
          },
          "encoding": {
            "x": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "title": "Employment Rate (%)",
              "scale": {
                "domain": [58, 68],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.5,
                "gridColor": "#e2e8f0",
                "gridWidth": 1,
                "gridDash": [3, 3],
                "titleFontSize": 14,
                "labelFontSize": 12,
                "labelPadding": 8,
                "titlePadding": 15,
                "domain": true,
                "domainColor": "#374151",
                "domainWidth": 2,
                "tickColor": "#6b7280",
                "tickSize": 8
              }
            },
            "y": {
              "field": "WageIndex",
              "type": "quantitative",
              "title": "Wage Index (Base=100)",
              "scale": {
                "domain": [147, 154],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.5,
                "gridColor": "#e2e8f0",
                "gridWidth": 1,
                "gridDash": [3, 3],
                "titleFontSize": 14,
                "labelFontSize": 12,
                "labelPadding": 8,
                "titlePadding": 15,
                "domain": true,
                "domainColor": "#374151",
                "domainWidth": 2,
                "tickColor": "#6b7280",
                "tickSize": 8
              }
            },
            "size": {
              "field": "Job_Vacancies",
              "type": "quantitative",
              "title": "Job Vacancies",
              "scale": {
                "type": "sqrt",
                "range": [200, 800]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 40
              }
            },
              "color": {
              "field": "Economic_Performance_Score",
              "type": "quantitative",
              "title": "Economic Performance",
              "scale": {
                "range": ["#ffffe0", "#ffd27f", "#c7e9e4", "#7fb8d6", "#b8d6f2"],
                "domain": [30, 65]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 200
              }
            },
            "tooltip": [
              {"field": "State", "type": "nominal", "title": "State/Territory"},
              {"field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)", "format": ".1f"},
              {"field": "WageIndex", "type": "quantitative", "title": "Wage Index", "format": ".1f"},
              {"field": "Job_Vacancies", "type": "quantitative", "title": "Vacancies", "format": ","},
              {"field": "Economic_Performance_Score", "type": "quantitative", "title": "Economic Score", "format": ".1f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 12,
            "dy": 0,
            "fontSize": 10,
            "fontWeight": "bold",
            "color": "#000000"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"},
            "text": {"field": "State_Code", "type": "nominal"}
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "right",
            "baseline": "bottom",
            "dx": -5,
            "dy": -5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Employment Rate"
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            },
            "y": {"value": 490}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "top",
            "dx": 5,
            "dy": 5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Wage Index"
          },
          "encoding": {
            "x": {"value": 10},
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Western Australia'"}],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "bottom",
            "dx": 0,
            "dy": -25,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#d2691e",
            "text": "WA - Highest Wages"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Australian Capital Territory'"}],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "bottom",
            "dx": 15,
            "dy": -15,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#2e8b57",
            "text": "ACT - Highest Employment"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        },
        {
          "transform": [{"filter": "datum.State == 'South Australia'"}],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "top",
            "dx": 0,
            "dy": 25,
            "fontSize": 10,
            "fontWeight": "bold",
            "color": "#8b0000",
            "text": ["SA - Lowest", "Employment Rate"]
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Tasmania'"}],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "top",
            "dx": 0,
            "dy": 20,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#4b0082",
            "text": "TAS - Lowest Wages"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        }
      ],
      "resolve": {
        "scale": {
          "color": "independent",
          "size": "independent"
        }
      },
      "config": {
        "background": "#ffffff",
        "view": {"stroke": "transparent"},
        "font": "Arial, sans-serif"
      }
    }
    </script>
    <script type="application/json" id="week9-map-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Australian Employment Rates by State/Territory",
  "width": "container",
  "height": 430,
      "autosize": { "type": "fit", "contains": "padding" },
      "projection": { "type": "conicEqualArea", "parallels": [-18, -36], "rotate": [-132,0], "center": [0,-28], "scale": 700 },
      "data": { "url": "assets/australia-states.geojson", "format": { "type": "json", "property": "features" } },
      "transform": [
        {
          "lookup": "properties.STATE_NAME",
          "from": {
            "data": {
              "values": [
                {"State": "Queensland","State_Code":"QLD","Employment_Rate":61.9,"Labour_Force":2618000},
                {"State": "Australian Capital Territory","State_Code":"ACT","Employment_Rate":67.2,"Labour_Force":230000},
                {"State": "South Australia","State_Code":"SA","Employment_Rate":59.8,"Labour_Force":864000},
                {"State": "Western Australia","State_Code":"WA","Employment_Rate":63.4,"Labour_Force":1391000},
                {"State": "Northern Territory","State_Code":"NT","Employment_Rate":63.1,"Labour_Force":134000},
                {"State": "Tasmania","State_Code":"TAS","Employment_Rate":58.7,"Labour_Force":276000},
                {"State": "New South Wales","State_Code":"NSW","Employment_Rate":62.8,"Labour_Force":4105000},
                {"State": "Victoria","State_Code":"VIC","Employment_Rate":63.1,"Labour_Force":3387000}
              ]
            },
            "key": "State",
            "fields": ["Employment_Rate","Labour_Force","State_Code"]
          }
        }
        ,
        {
          "calculate": "datum.Employment_Rate >= 66 ? 'High' : datum.Employment_Rate <= 60 ? 'Low' : 'Medium'",
          "as": "Employment_Level"
        }
      ],
  "mark": { "type": "geoshape", "stroke": "rgba(255,255,255,0.9)", "strokeWidth": 0.9 },
      "params": [
        { "name": "hoverState", "select": { "type": "point", "on": "mouseover", "clear": "mouseout" } }
      ],
        "encoding": {
          "color": { "field": "Employment_Rate", "type": "quantitative", "scale": { "range": ["#fef3c7", "#fde68a", "#bfdbfe", "#93c5fd", "#60a5fa", "#3b82f6", "#1d4ed8"], "domain": [58,68] }, "legend": { "title": "Employment Rate (%)", "orient": "left", "tickMinStep": 1, "values": [58,62,66,68], "format": ".0f", "offset": 10 } },
          "stroke": { "condition": { "param": "hoverState", "value": "rgba(33,37,41,0.22)" }, "value": "rgba(255,255,255,0.9)" },
          "strokeWidth": { "condition": { "param": "hoverState", "value": 2 }, "value": 0.9 },
          "opacity": { "condition": { "param": "hoverState", "value": 1 }, "value": 0.95 },
          "tooltip": [ { "field": "properties.STATE_NAME", "type": "nominal", "title": "State" }, { "field": "Employment_Rate", "type": "quantitative", "title": "Employment (%)", "format": ".1f" }, { "field": "Labour_Force", "type": "quantitative", "title": "Labour", "format": ",.0f" }, { "field": "Employment_Level", "type": "nominal", "title": "Level" } ]
        },
      "config": { "view": { "stroke": "transparent" }, "background": "#f8fafc" }
    }
    </script>

    <script>
    // Load Week 9 Choropleth Map with optimized settings
    (function loadMapSafely() {
      const mapScriptEl = document.getElementById('week9-map-spec');
      if (!mapScriptEl) {
        console.warn('week9-map-spec element not found — skipping map embed (check that the inline spec exists and has id="week9-map-spec")');
        return;
      }
      let mapSpec = null;
      try {
        mapSpec = JSON.parse(mapScriptEl.textContent);
      } catch (e) {
        console.error('Could not parse week9-map-spec JSON:', e);
        document.getElementById('map-vis').innerHTML = '<div style="text-align:center;padding:30px;color:#e74c3c;"><strong>⚠️ Invalid map specification:</strong> '+e.message+'</div>';
        return;
      }

  vegaEmbed('#map-vis', mapSpec, {
    theme: 'googlecharts',
    renderer: 'svg',  // Use SVG for crisper hover/stroke transitions
            actions: {
                export: false,  // Disable to reduce loading time
                source: false,
                compiled: false,
                editor: false
            },
  padding: {left: 70, right: 8, top: 8, bottom: 8}
        }).then(function(result) {
            console.log('✅ Week 9 choropleth map loaded successfully');
            
            // Optimize view for faster interactions
            result.view.runAfter(function() {
                result.view.hover();  // Enable fast hover
            });
            
        }).catch(function(error) {
            console.error('❌ Error loading Week 9 map:', error);
            document.getElementById('map-vis').innerHTML = 
                '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
                '<h3>⚠️ Map Loading Error</h3>' +
                '<p>Please ensure australia-states.geojson and labour_force_cleaned.csv are available.</p>' +
                '</div>';
        });
})();



    // Wire up controls for the new charts
    (function setupChartControls() {
      // Vacancies chart controls
      const vacanciesWageSelect = document.getElementById('vacancies-wage-select');
      
      if (vacanciesWageSelect) {
        vacanciesWageSelect.addEventListener('change', function(e) {
          const vacanciesView = window.vacanciesView;
          if (vacanciesView) {
            vacanciesView.signal('wageGrowthFilter', e.target.value).run();
          }
        });
      }

      // Performance metric chart controls
      const performanceStateSelect = document.getElementById('performance-state-select');
      
      if (performanceStateSelect) {
        performanceStateSelect.addEventListener('change', function(e) {
          const radarView = window.radarPerformanceView;
          if (radarView) {
            radarView.signal('highlightState', e.target.value).run();
          }
        });
      }

      // Bubble chart controls  
      const bubbleSizeSelect = document.getElementById('bubble-size-select');
      
      if (bubbleSizeSelect) {
        bubbleSizeSelect.addEventListener('change', function(e) {
          const bubbleView = window.matrixView;
          if (bubbleView) {
            bubbleView.signal('bubbleSize', e.target.value).run();
          }
        });
      }
    })();

    </script>
</body>
</html>
