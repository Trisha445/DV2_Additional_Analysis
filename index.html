<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Labour Market Analysis - Week 9 & Week 10</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Georgia:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Georgia', serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header .description {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .content {
            padding: 40px;
        }

        .visualization-section {
            margin-bottom: 50px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            color: #2d3436;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-badge {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }

        .chart-container:hover {
            transform: translateY(-5px);
        }

        .chart-description {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #00b894;
        }

        .chart-description h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .chart-description p {
            color: #636e72;
            margin-bottom: 10px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #fd79a8;
        }

        .feature-card h4 {
            color: #2d3436;
            margin-bottom: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            color: #636e72;
            font-size: 0.9rem;
        }

        .insights-section {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 40px;
        }

        .insights-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .insight-item h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .data-sources {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .responsive-container {
            width: 100%;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Vega-Lite tooltip styling */
        .vega-tooltip {
            font-family: 'Inter', sans-serif !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            border: 1px solid #ddd !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(10px) !important;
        }

        .vega-tooltip-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 4px !important;
        }

        .vega-tooltip table {
            font-size: 13px !important;
        }

        .vega-tooltip td.key {
            font-weight: 600 !important;
            color: #34495e !important;
            padding-right: 12px !important;
        }

        .vega-tooltip td.value {
            font-weight: 500 !important;
            color: #2c3e50 !important;
        }
    /* Dashboard grid & card refinements for HD layout */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* show 2 per row for demo */
      gap: 24px;
      align-items: start;
      justify-items: center;
    }

    .chart-card, .feature-card {
      background: linear-gradient(180deg, #ffffff 0%, #fbfbfd 100%);
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 12px 30px rgba(17,24,39,0.06);
      transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 360px;
      min-width: 340px;
    }

    .chart-card:hover, .feature-card:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow: 0 20px 40px rgba(17,24,39,0.12);
    }

    .chart-title {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.6rem;
    }

    .chart-figure {
      flex: 1 1 auto;
      display:block;
      min-height: 240px;
    }

    .chart-annotation {
      margin-top: 0.8rem;
      font-size: 0.95rem;
      color: #475569;
      background: rgba(15,23,42,0.02);
      padding: 0.6rem 0.8rem;
      border-radius: 0.5rem;
    }

    /* fade-in when charts load */
    .chart-loaded { animation: chartFadeIn 420ms ease both; }
    @keyframes chartFadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 1100px) {
      .charts-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 640px) {
      .charts-grid { grid-template-columns: 1fr; }
      .chart-card { padding: 1rem; }
    }
    </style>
</head>
<body>
    <script>
      // Defensive helpers: some older code expected showLoading/hideLoading globally.
      // These safely no-op if the related DOM elements don't exist to avoid "reading 'style' of null" errors.
      function showLoading(msg) {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return; // gracefully return when missing
          el.style.display = 'block';
          if (msg) el.textContent = msg;
        } catch (e) {
          console.warn('showLoading error (ignored):', e && e.message);
        }
      }

      function hideLoading() {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return;
          el.style.display = 'none';
        } catch (e) {
          console.warn('hideLoading error (ignored):', e && e.message);
        }
      }
    </script>
    <div class="container">
        <div class="header">
            <h1>🇦🇺 Australian Labour Market Analysis</h1>
            <div class="subtitle">Comprehensive Spatial and Statistical Visualization</div>
            <div class="description">
                An integrated analysis combining geographic employment patterns (Week 9) with 
                employment-wage relationships (Week 10) using Australian Bureau of Statistics data
            </div>
        </div>

        <div class="content">
            <!-- Week 9: Choropleth Map Section -->
            <div class="visualization-section">
                <div class="section-header">
                    <div class="section-title">
                        🗺️ Geographic Employment Analysis
                    </div>
                    <div class="week-badge">Week 9 Homework</div>
                </div>

                <div class="chart-description">
                    <h3>Interactive Choropleth Map</h3>
                    <p>This spatial visualization displays employment rates across Australian states and territories using color-coded regions and proportional symbols. The choropleth encoding reveals geographic patterns in labour force participation, while circle sizes represent the absolute labour force size in each jurisdiction.</p>
                    <p><strong>Data Source:</strong> Australian Bureau of Statistics Labour Force Survey (6291.0.55.001), Q3 2025</p>
                </div>

                <div class="chart-container">
                    <div class="responsive-container">
                        <div id="map-vis" style="width: 100%; min-height: 500px; margin-top: 80px; margin-bottom: 60px;"></div>
                    </div>
                </div>
            </div>

            <!-- Week 10: Scatter Plot Section -->
            <div class="visualization-section">
                <div class="section-header">
                    <div class="section-title">
                        📈 Employment-Wage Relationship Analysis
                    </div>
                    <div class="week-badge">Week 10 Analysis</div>
                </div>

                <div class="chart-description">
                    <h3>Multi-Channel Scatter Plot</h3>
                    <p>This advanced visualization explores the relationship between employment rates and wage indices across Australian states. Using position, size, and color encoding, it reveals complex patterns in labour market dynamics and economic performance.</p>
                    <p><strong>Data Sources:</strong> ABS Labour Force Survey (6291.0.55.001) + Wage Price Index (6345.0), Q3 2025</p>
                </div>

                <!-- Interactive Filter Controls -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 15px 0; color: #2d3748;">🔧 Interactive Filters (Week 10 Requirement)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <label for="employment-filter" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Employment Category:</label>
                            <select id="employment-filter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;">
                                <option value="All">All Categories</option>
                                <option value="Above Average">Above Average</option>
                                <option value="Average">Average</option>
                                <option value="Below Average">Below Average</option>
                            </select>
                        </div>
                        <div>
                            <label for="wage-growth-filter" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Wage Growth Category:</label>
                            <select id="wage-growth-filter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;">
                                <option value="All">All Categories</option>
                                <option value="High Growth">High Growth</option>
                                <option value="Moderate Growth">Moderate Growth</option>
                            </select>
                        </div>
                        <div>
                            <label for="economic-score-slider" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Min Economic Score: <span id="score-value">30</span></label>
                            <input type="range" id="economic-score-slider" min="30" max="65" step="5" value="30" style="width: 100%;">
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #718096;">
                        💡 Use the controls above to filter the scatter plot data in real-time
                    </div>
                </div>

                <div class="chart-container">
                    <div class="responsive-container">
                        <div id="scatter-vis" style="width: 100%; min-height: 500px;"></div>
                    </div>
        </div>
      </div>

      <!-- Additional Charts Section -->
      <div class="visualization-section">
        <div class="section-header">
          <div class="section-title">📚 Additional Charts</div>
          <div class="week-badge">Supplementary</div>
        </div>

        <div class="chart-description">
          <h3>Supplementary Visualizations</h3>
          <p>The charts below load additional Vega / Vega-Lite specifications from the <code>assets/</code> folder. If a file is missing or the JSON is invalid you'll see a friendly error message in its card.</p>
        </div>

        <div class="chart-container">
          <div class="charts-grid">
            <div class="chart-card">
              <div class="chart-title">Vacancies by Industry</div>
              <div id="vacancies-vis" class="chart-figure"></div>
              <div class="chart-annotation">Summary: Shows distribution of job vacancies across states (higher values indicate more openings).</div>
            </div>

            <div class="chart-card">
              <div class="chart-title">Wage vs Employment Comparison</div>
              <div id="wage-employment-vis" class="chart-figure"></div>
              <div class="chart-annotation">Comparison of wage growth and employment rates across states — highlighting economic performance balance.</div>
            </div>

            <div class="chart-card">
              <div class="chart-title">Unemployment Heatmap</div>
              <div id="heatmap-unemployment-vis" class="chart-figure"></div>
              <div class="chart-annotation">Summary: Unemployment rate heatmap (state vs period) — darker = higher unemployment.</div>
            </div>

            <div class="chart-card">
              <div class="chart-title">Stacked by Gender</div>
              <div id="stacked-gender-vis" class="chart-figure"></div>
              <div class="chart-annotation">Summary: Stacked representation of employment rates by group (fallback aggregated by state).</div>
            </div>

            <div class="chart-card">
              <div class="chart-title">Employment & Vacancies (Bubble)</div>
              <div id="bubble-vis" class="chart-figure"></div>
              <div class="chart-annotation">Summary: Bubble chart mapping employment rate (x), wage index (y), and vacancies (size).</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Insights Section -->
      <div class="insights-section">
                <h2>🔍 Key Insights from Combined Analysis</h2>
                <div class="insights-grid">
                    <div class="insight-item">
                        <h3>Geographic Patterns</h3>
                        <p>The choropleth map reveals significant regional variation in employment rates, with metropolitan areas generally showing different patterns from rural regions.</p>
                    </div>
                    <div class="insight-item">
                        <h3>Employment-Wage Dynamics</h3>
                        <p>The scatter plot demonstrates that high employment rates don't always correlate with high wages, suggesting varied economic structures across states.</p>
                    </div>
                    <div class="insight-item">
                        <h3>Economic Performance</h3>
                        <p>States with balanced employment and wage growth show stronger overall economic performance, as indicated by the color encoding.</p>
                    </div>
                    <div class="insight-item">
                        <h3>Labour Market Opportunities</h3>
                        <p>Job vacancy data reveals where employment growth is most active, providing insights for policy and investment decisions.</p>
                    </div>
                </div>
            </div>

            <!-- Data Sources -->
            <div class="data-sources">
                <h3>📊 Data Sources & Methodology</h3>
                <p>
                    <strong>Primary Data:</strong> Australian Bureau of Statistics Labour Force Survey (6291.0.55.001) and Wage Price Index (6345.0) for Q3 2025.<br>
                    <strong>Spatial Data:</strong> Australian state boundaries in GeoJSON format with Albers Equal-Area Conic projection.<br>
                    <strong>Derived Metrics:</strong> Economic Performance Score calculated using weighted combination of employment rates (60%) and wage growth (40%). Job vacancy estimates based on ABS historical patterns and current labour market indicators.
                </p>
            </div>
        </div>
    </div>

    <!-- Embedded Vega-Lite Specifications -->
    <script type="application/json" id="week9-map-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Australian Employment Rates by State/Territory",
        "fontSize": 20,
        "anchor": "start",
        "color": "#000000",
        "fontWeight": "bold",
        "subtitle": ["Interactive choropleth map showing employment rates with proportional symbols for labour force size", "Data: ABS Labour Force Survey Q3 2025"],
        "subtitleFontSize": 14,
        "subtitleColor": "#000000",
        "offset": 25
      },
      "width": 850,
      "height": 550,
      "background": "#f8fafc",
      "projection": {
        "type": "conicEqualArea",
        "parallels": [-18, -36],
        "rotate": [-132, 0],
        "center": [0, -28],
        "scale": 700
      },
      "layer": [
        {
          "data": {
            "url": "assets/australia-states.geojson",
            "format": {"type": "json", "property": "features"}
          },
          "transform": [
            {
              "lookup": "properties.STATE_NAME",
              "from": {
                "data": {
                  "values": [
                    {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Labour_Force": 2618000, "Unemployment_Rate": 4.1, "Participation_Rate": 64.5},
                    {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Labour_Force": 230000, "Unemployment_Rate": 2.8, "Participation_Rate": 69.1},
                    {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Labour_Force": 864000, "Unemployment_Rate": 4.3, "Participation_Rate": 62.5},
                    {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Labour_Force": 1391000, "Unemployment_Rate": 3.0, "Participation_Rate": 65.3},
                    {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Labour_Force": 134000, "Unemployment_Rate": 3.7, "Participation_Rate": 65.5},
                    {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Labour_Force": 276000, "Unemployment_Rate": 3.9, "Participation_Rate": 61.1},
                    {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Labour_Force": 4105000, "Unemployment_Rate": 3.2, "Participation_Rate": 65.0},
                    {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Labour_Force": 3387000, "Unemployment_Rate": 3.4, "Participation_Rate": 65.3}
                  ]
                },
                "key": "State",
                "fields": ["Employment_Rate", "Labour_Force", "Unemployment_Rate", "State_Code", "Participation_Rate"]
              }
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "#ffffff",
            "strokeWidth": 2.5,
            "strokeOpacity": 1,
            "cursor": "pointer"
          },
          "encoding": {
            "color": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "scale": {
                "type": "linear",
                "range": ["#e6f3ff", "#1e40af"],
                "domain": [58, 68]
              },
              "legend": {
                "title": "Employment Rate (%)",
                "orient": "right",
                "offset": 30,
                "gradientLength": 250,
                "titleFontSize": 14,
                "titleFontWeight": "bold",
                "labelFontSize": 12,
                "gradientThickness": 20,
                "cornerRadius": 5,
                "titleColor": "#000000",
                "labelColor": "#000000"
              }
            },
            "opacity": {
              "condition": {"selection": "highlight", "value": 1.0},
              "value": 0.85
            },
            "stroke": {
              "condition": {"selection": "highlight", "value": "#2563eb"},
              "value": "#ffffff"
            },
            "strokeWidth": {
              "condition": {"selection": "highlight", "value": 3},
              "value": 2.5
            },
            "tooltip": [
              {"field": "properties.STATE_NAME", "type": "nominal", "title": "🗺️ State/Territory"},
              {"field": "Employment_Rate", "type": "quantitative", "title": "📊 Employment Rate", "format": ".1f", "formatType": "number"},
              {"field": "Labour_Force", "type": "quantitative", "title": "👥 Labour Force Total", "format": ",.0f"},
              {"field": "Unemployment_Rate", "type": "quantitative", "title": "📉 Unemployment Rate", "format": ".1f", "formatType": "number"},
              {"field": "Participation_Rate", "type": "quantitative", "title": "📈 Participation Rate", "format": ".1f", "formatType": "number"}
            ]
          },
          "selection": {
            "highlight": {"type": "single", "on": "mouseover", "empty": "all"}
          }
        },
        {
          "data": {
            "values": [
              {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Labour_Force": 2618000, "Population": 5156000, "Unemployment_Rate": 4.1, "longitude": 153.0, "latitude": -27.5},
              {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Labour_Force": 230000, "Population": 431000, "Unemployment_Rate": 2.8, "longitude": 149.1, "latitude": -35.3},
              {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Labour_Force": 864000, "Population": 1771000, "Unemployment_Rate": 4.3, "longitude": 138.6, "latitude": -34.9},
              {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Labour_Force": 1391000, "Population": 2667000, "Unemployment_Rate": 3.0, "longitude": 115.9, "latitude": -32.0},
              {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Labour_Force": 134000, "Population": 249000, "Unemployment_Rate": 3.7, "longitude": 130.8, "latitude": -12.5},
              {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Labour_Force": 276000, "Population": 542000, "Unemployment_Rate": 3.9, "longitude": 147.3, "latitude": -42.9},
              {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Labour_Force": 4105000, "Population": 8166000, "Unemployment_Rate": 3.2, "longitude": 151.2, "latitude": -33.9},
              {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Labour_Force": 3387000, "Population": 6681000, "Unemployment_Rate": 3.4, "longitude": 144.9, "latitude": -37.8}
            ]
          },
          "mark": {
            "type": "circle",
            "stroke": "#ffffff",
            "strokeWidth": 3,
            "opacity": 0.9,
            "cursor": "pointer"
          },
          "encoding": {
            "longitude": {"field": "longitude", "type": "quantitative"},
            "latitude": {"field": "latitude", "type": "quantitative"},
            "size": {
              "field": "Labour_Force",
              "type": "quantitative",
              "scale": {"type": "sqrt", "range": [300, 1200], "domain": [100000, 4500000]},
              "legend": {
                "title": "Labour Force Size",
                "orient": "right",
                "offset": 220,
                "titleFontSize": 14,
                "titleFontWeight": "bold",
                "labelFontSize": 12,
                "symbolType": "circle",
                "symbolStrokeWidth": 2,
                "symbolStrokeColor": "#ffffff",
                "values": [1000000, 2000000, 3000000, 4000000],
                "format": ",.0f",
                "titleColor": "#000000",
                "labelColor": "#000000"
              }
            },
            "color": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "scale": {
                "type": "linear",
                "range": ["#fef3c7", "#dc2626"],
                "domain": [58, 68]
              }
            },
            "opacity": {
              "condition": {"selection": "circle_highlight", "value": 1.0},
              "value": 0.9
            },
            "strokeWidth": {
              "condition": {"selection": "circle_highlight", "value": 4},
              "value": 3
            },
            "tooltip": [
              {"field": "State", "type": "nominal", "title": "🏛️ State/Territory"},
              {"field": "State_Code", "type": "nominal", "title": "🔤 Code"},
              {"field": "Employment_Rate", "type": "quantitative", "title": "📊 Employment Rate", "format": ".1f", "formatType": "number"},
              {"field": "Labour_Force", "type": "quantitative", "title": "👥 Labour Force", "format": ",.0f"},
              {"field": "Population", "type": "quantitative", "title": "🏘️ Population", "format": ",.0f"},
              {"field": "Unemployment_Rate", "type": "quantitative", "title": "📉 Unemployment Rate", "format": ".1f", "formatType": "number"}
            ]
          },
          "selection": {
            "circle_highlight": {"type": "single", "on": "mouseover", "empty": "all"}
          }
        },
        {
          "data": {
            "values": [
              {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Labour_Force": 2618000, "Population": 5156000, "Unemployment_Rate": 4.1},
              {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Labour_Force": 230000, "Population": 431000, "Unemployment_Rate": 2.8},
              {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Labour_Force": 864000, "Population": 1771000, "Unemployment_Rate": 4.3},
              {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Labour_Force": 1391000, "Population": 2667000, "Unemployment_Rate": 3.0},
              {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Labour_Force": 134000, "Population": 249000, "Unemployment_Rate": 3.7},
              {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Labour_Force": 276000, "Population": 542000, "Unemployment_Rate": 3.9},
              {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Labour_Force": 4105000, "Population": 8166000, "Unemployment_Rate": 3.2},
              {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Labour_Force": 3387000, "Population": 6681000, "Unemployment_Rate": 3.4}
            ]
          },
          "transform": [
            {
              "calculate": "datum.State_Code == 'NSW' ? 151.2 : datum.State_Code == 'VIC' ? 144.9 : datum.State_Code == 'QLD' ? 153.0 : datum.State_Code == 'WA' ? 115.9 : datum.State_Code == 'SA' ? 138.6 : datum.State_Code == 'TAS' ? 147.3 : datum.State_Code == 'ACT' ? 149.1 : datum.State_Code == 'NT' ? 130.8 : 0",
              "as": "longitude"
            },
            {
              "calculate": "datum.State_Code == 'NSW' ? -33.9 : datum.State_Code == 'VIC' ? -37.8 : datum.State_Code == 'QLD' ? -27.5 : datum.State_Code == 'WA' ? -32.0 : datum.State_Code == 'SA' ? -34.9 : datum.State_Code == 'TAS' ? -42.9 : datum.State_Code == 'ACT' ? -35.3 : datum.State_Code == 'NT' ? -12.5 : 0",
              "as": "latitude"
            }
          ],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dy": -35,
            "fontSize": 14,
            "fontWeight": "bold",
            "color": "#000000"
          },
          "encoding": {
            "longitude": {"field": "longitude", "type": "quantitative"},
            "latitude": {"field": "latitude", "type": "quantitative"},
            "text": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "format": ".1f"
            }
          }
        },
        {
          "data": {
            "values": [
              {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Labour_Force": 2618000, "Population": 5156000, "Unemployment_Rate": 4.1},
              {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Labour_Force": 230000, "Population": 431000, "Unemployment_Rate": 2.8},
              {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Labour_Force": 864000, "Population": 1771000, "Unemployment_Rate": 4.3},
              {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Labour_Force": 1391000, "Population": 2667000, "Unemployment_Rate": 3.0},
              {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Labour_Force": 134000, "Population": 249000, "Unemployment_Rate": 3.7},
              {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Labour_Force": 276000, "Population": 542000, "Unemployment_Rate": 3.9},
              {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Labour_Force": 4105000, "Population": 8166000, "Unemployment_Rate": 3.2},
              {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Labour_Force": 3387000, "Population": 6681000, "Unemployment_Rate": 3.4}
            ]
          },
          "transform": [
            {
              "calculate": "datum.State_Code == 'NSW' ? 151.2 : datum.State_Code == 'VIC' ? 144.9 : datum.State_Code == 'QLD' ? 153.0 : datum.State_Code == 'WA' ? 115.9 : datum.State_Code == 'SA' ? 138.6 : datum.State_Code == 'TAS' ? 147.3 : datum.State_Code == 'ACT' ? 149.1 : datum.State_Code == 'NT' ? 130.8 : 0",
              "as": "longitude"
            },
            {
              "calculate": "datum.State_Code == 'NSW' ? -33.9 : datum.State_Code == 'VIC' ? -37.8 : datum.State_Code == 'QLD' ? -27.5 : datum.State_Code == 'WA' ? -32.0 : datum.State_Code == 'SA' ? -34.9 : datum.State_Code == 'TAS' ? -42.9 : datum.State_Code == 'ACT' ? -35.3 : datum.State_Code == 'NT' ? -12.5 : 0",
              "as": "latitude"
            }
          ],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dy": -18,
            "fontSize": 11,
            "fontWeight": "600",
            "color": "#000000"
          },
          "encoding": {
            "longitude": {"field": "longitude", "type": "quantitative"},
            "latitude": {"field": "latitude", "type": "quantitative"},
            "text": {
              "value": "%"
            }
          }
        },
        {
          "data": {
            "values": [
              {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Labour_Force": 2618000, "Population": 5156000, "Unemployment_Rate": 4.1},
              {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Labour_Force": 230000, "Population": 431000, "Unemployment_Rate": 2.8},
              {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Labour_Force": 864000, "Population": 1771000, "Unemployment_Rate": 4.3},
              {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Labour_Force": 1391000, "Population": 2667000, "Unemployment_Rate": 3.0},
              {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Labour_Force": 134000, "Population": 249000, "Unemployment_Rate": 3.7},
              {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Labour_Force": 276000, "Population": 542000, "Unemployment_Rate": 3.9},
              {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Labour_Force": 4105000, "Population": 8166000, "Unemployment_Rate": 3.2},
              {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Labour_Force": 3387000, "Population": 6681000, "Unemployment_Rate": 3.4}
            ]
          },
          "transform": [
            {
              "calculate": "datum.State_Code == 'NSW' ? 151.2 : datum.State_Code == 'VIC' ? 144.9 : datum.State_Code == 'QLD' ? 153.0 : datum.State_Code == 'WA' ? 115.9 : datum.State_Code == 'SA' ? 138.6 : datum.State_Code == 'TAS' ? 147.3 : datum.State_Code == 'ACT' ? 149.1 : datum.State_Code == 'NT' ? 130.8 : 0",
              "as": "longitude"
            },
            {
              "calculate": "datum.State_Code == 'NSW' ? -33.9 : datum.State_Code == 'VIC' ? -37.8 : datum.State_Code == 'QLD' ? -27.5 : datum.State_Code == 'WA' ? -32.0 : datum.State_Code == 'SA' ? -34.9 : datum.State_Code == 'TAS' ? -42.9 : datum.State_Code == 'ACT' ? -35.3 : datum.State_Code == 'NT' ? -12.5 : 0",
              "as": "latitude"
            }
          ],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "middle",
            "dy": 30,
            "fontSize": 13,
            "fontWeight": "bold",
            "color": "#000000"
          },
          "encoding": {
            "longitude": {"field": "longitude", "type": "quantitative"},
            "latitude": {"field": "latitude", "type": "quantitative"},
            "text": {
              "field": "State_Code",
              "type": "nominal"
            }
          }
        }
      ],
      "resolve": {"scale": {"color": "independent", "size": "independent"}},
      "config": {
        "background": "#f8fafc",
        "view": {"stroke": "transparent"},
        "font": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
        "title": {
          "font": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
          "fontWeight": "bold",
          "color": "#000000"
        },
        "axis": {
          "labelFont": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
          "titleFont": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
          "labelColor": "#000000",
          "titleColor": "#000000"
        },
        "legend": {
          "labelFont": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
          "titleFont": "Inter, -apple-system, BlinkMacSystemFont, sans-serif",
          "labelColor": "#000000",
          "titleColor": "#000000"
        }
      }
    }
    </script>
    
    <!-- Inline specs to avoid fetch/path issues -->
    <script type="application/json" id="vacancies-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Job vacancies by state (inline)",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": 420,
      "height": 320,
      "mark": { "type": "bar", "cornerRadius": 6 },
      "encoding": {
        "x": { "field": "State", "type": "nominal", "sort": "-y", "axis": { "labelAngle": -45 } },
        "y": { "field": "Job_Vacancies", "type": "quantitative", "title": "Job Vacancies" },
        "color": { "field": "Job_Vacancies", "type": "quantitative", "scale": { "scheme": "blues" }, "legend": null },
        "tooltip": [ { "field": "State", "type": "nominal" }, { "field": "Job_Vacancies", "type": "quantitative", "format": "," } ]
      }
    }
    </script>

    <script type="application/json" id="bubble-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Bubble chart: Employment Rate vs Wage Index, bubble size = Job Vacancies (inline)",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": 420,
      "height": 320,
      "mark": { "type": "circle", "opacity": 0.85, "stroke": "#333" },
      "encoding": {
        "x": { "field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)" },
        "y": { "field": "WageIndex", "type": "quantitative", "title": "Wage Index" },
        "size": { "field": "Job_Vacancies", "type": "quantitative", "title": "Job Vacancies", "scale": { "type": "sqrt", "range": [100, 1200] } },
        "color": { "field": "Economic_Performance_Score", "type": "quantitative", "scale": { "scheme": "reds" } },
        "tooltip": [ { "field": "State", "type": "nominal" }, { "field": "Job_Vacancies", "type": "quantitative", "format": "," }, { "field": "WageIndex", "type": "quantitative", "format": ".1f" } ]
      }
    }
    </script>
    
  <script>
    // Dynamically load and embed selected Vega(-Lite) JSON specs after DOM is ready.
    (function() {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM ready — starting chart embedding');

        // Target charts to embed for verification
        // For vacancies and bubble we prefer inline specs (specId) to avoid fetch/path issues
        const chartsToLoad = [
          {id: 'wage-employment-vis', file: './assets/wage_vs_employment.json'},
          {id: 'vacancies-vis', specId: 'vacancies-spec'},
          {id: 'heatmap-unemployment-vis', file: './assets/heatmap_unemployment.json'},
          {id: 'stacked-gender-vis', file: './assets/stacked_by_gender.json'},
          {id: 'bubble-vis', specId: 'bubble-spec'}
        ];

        chartsToLoad.forEach(function(chart) {
          console.log('Attempting to load', chart.file || ('inline spec ' + chart.specId), 'into', chart.id);
          embedChart(chart);
        });

        function embedChart(chart) {
          const id = chart.id;
          const container = document.getElementById(id);
          if (!container) {
            console.warn('Container not found for', id);
            return;
          }

          // If inline spec provided, use it
          if (chart.specId) {
            try {
              const scriptEl = document.getElementById(chart.specId);
              if (!scriptEl) throw new Error('Inline spec element not found: ' + chart.specId);
              const jsonText = scriptEl.textContent.trim();
              if (!jsonText) throw new Error('Inline spec is empty: ' + chart.specId);
              const spec = JSON.parse(jsonText);
              console.log('Parsed inline spec', chart.specId, ' — embedding now');
              vegaEmbed('#' + id, spec, { theme: 'googlecharts', renderer: 'canvas', actions: {export: false, source: false, compiled: false, editor: false}, padding: {left:18, right:18, top:18, bottom:18} })
                .then(function() { document.getElementById(id).classList.add('chart-loaded'); console.log('✅ Embedded inline', chart.specId, 'into', id); })
                .catch(function(err) { container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Error embedding inline spec:</strong> '+err.message+'</div>'; console.error('Embed error for inline', chart.specId, err); });
              return;
            } catch (err) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Inline spec error:</strong> '+err.message+'</div>';
              console.warn('Inline spec error for', chart.specId, err);
              return;
            }
          }

          // Otherwise fetch the JSON spec
          const file = chart.file;
          fetch(file).then(function(resp) {
            if (!resp.ok) throw new Error('HTTP ' + resp.status + ' ' + resp.statusText);
            const ct = resp.headers.get('content-type') || '';
            // If the server returned HTML (e.g. an error page or redirected HTML), fail fast with useful message
            if (ct.indexOf('text/html') !== -1) throw new Error('Unexpected HTML response (Content-Type: ' + ct + '). The file path may be wrong or GitHub Pages served an error page.');
            return resp.text();
          }).then(function(text) {
            const trimmed = text.trim();
            console.debug('Fetched', file, 'length:', trimmed.length, 'sample:', trimmed.slice(0,200));
            if (!trimmed) throw new Error('Empty file');

            // attempt to extract JSON from HTML wrappers (some assets were wrapped in <script> blocks)
            let jsonText = trimmed;
            const scriptMatch = trimmed.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
            if (scriptMatch) jsonText = scriptMatch[1];

            let spec;
            try {
              spec = JSON.parse(jsonText);
            } catch (err) {
              // Provide a clearer error when the text begins with '<' which commonly indicates HTML
              if (jsonText.trim().charAt(0) === '<') {
                throw new Error('Invalid JSON: file appears to contain HTML/markup. This often happens if the asset path is wrong or GitHub Pages returned an HTML error page.');
              }
              // Try to pull JSON out of an application/json script block if present
              const jsonBlockMatch = trimmed.match(/<script[^>]+type="application\/json"[^>]*>([\s\S]*?)<\/script>/i);
              if (jsonBlockMatch) {
                try { spec = JSON.parse(jsonBlockMatch[1]); }
                catch (innerErr) { throw innerErr; }
              } else {
                throw err; // rethrow original JSON parse error
              }
            }

            console.log('Parsed spec for', file, ' — embedding now');

            vegaEmbed('#' + id, spec, {
              theme: 'googlecharts', renderer: 'canvas',
              actions: {export: false, source: false, compiled: false, editor: false},
              padding: {left:18, right:18, top:18, bottom:18}
            }).then(function(result) {
              // Add loaded class for animation
              const el = document.getElementById(id);
              if (el) el.classList.add('chart-loaded');
              console.log('✅ Embedded', file, 'into', id);
            }).catch(function(embedErr) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Error embedding:</strong> '+embedErr.message+'</div>';
              console.error('Embed error for', file, embedErr);
            });

          }).catch(function(fetchErr) {
            container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>⚠️ Could not load chart file:</strong> '+fetchErr.message+'</div>';
            console.warn('Could not load', file, fetchErr);
          });
        }
      });
    })();
  </script>

    <script type="application/json" id="week10-scatter-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Employment Rate vs Wage Index Analysis",
        "subtitle": "Multi-channel encoding: Position (Employment vs Wages), Size (Job Vacancies), Color (Economic Performance) | Use filters below to explore data",
        "fontSize": 16,
        "subtitleFontSize": 12,
        "color": "#000000",
        "subtitleColor": "#333333",
        "anchor": "start"
      },
      "params": [
        {
          "name": "employmentCategoryFilter",
          "bind": {
            "input": "select",
            "options": ["All", "Above Average", "Average", "Below Average"],
            "name": "Employment Category Filter: "
          },
          "value": "All"
        },
        {
          "name": "economicScoreSlider",
          "bind": {
            "input": "range",
            "min": 30,
            "max": 65,
            "step": 5,
            "name": "Minimum Economic Performance Score: "
          },
          "value": 30
        },
        {
          "name": "wageGrowthFilter",
          "bind": {
            "input": "select",
            "options": ["All", "High Growth", "Moderate Growth"],
            "name": "Wage Growth Category Filter: "
          },
          "value": "All"
        }
      ],
      "width": 800,
      "height": 500,
      "data": {
        "values": [
          {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Unemployment_Rate": 4.1, "Participation_Rate": 64.5, "Labour_Force": 2618000, "Population": 5156000, "WageIndex": 149.5, "WageGrowthRate": 2.48, "Employment_to_Wage_Ratio": 41.405, "Job_Vacancies": 63356, "Job_Vacancy_Rate": 24.2, "Economic_Performance_Score": 62.6, "Employment_Category": "Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Unemployment_Rate": 2.8, "Participation_Rate": 69.1, "Labour_Force": 230000, "Population": 431000, "WageIndex": 152.9, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 43.95, "Job_Vacancies": 7291, "Job_Vacancy_Rate": 31.7, "Economic_Performance_Score": 60.0, "Employment_Category": "Above Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Unemployment_Rate": 4.3, "Participation_Rate": 62.5, "Labour_Force": 864000, "Population": 1771000, "WageIndex": 148.2, "WageGrowthRate": 2.45, "Employment_to_Wage_Ratio": 40.351, "Job_Vacancies": 18490, "Job_Vacancy_Rate": 21.4, "Economic_Performance_Score": 44.5, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Unemployment_Rate": 3.0, "Participation_Rate": 65.3, "Labour_Force": 1391000, "Population": 2667000, "WageIndex": 153.7, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.249, "Job_Vacancies": 44651, "Job_Vacancy_Rate": 32.1, "Economic_Performance_Score": 37.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Unemployment_Rate": 3.7, "Participation_Rate": 65.5, "Labour_Force": 134000, "Population": 249000, "WageIndex": 152.4, "WageGrowthRate": 2.16, "Employment_to_Wage_Ratio": 41.404, "Job_Vacancies": 3926, "Job_Vacancy_Rate": 29.3, "Economic_Performance_Score": 36.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Unemployment_Rate": 3.9, "Participation_Rate": 61.1, "Labour_Force": 276000, "Population": 542000, "WageIndex": 147.6, "WageGrowthRate": 2.43, "Employment_to_Wage_Ratio": 39.77, "Job_Vacancies": 5465, "Job_Vacancy_Rate": 19.8, "Economic_Performance_Score": 34.6, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Unemployment_Rate": 3.2, "Participation_Rate": 65.0, "Labour_Force": 4105000, "Population": 8166000, "WageIndex": 150.8, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.645, "Job_Vacancies": 116992, "Job_Vacancy_Rate": 28.5, "Economic_Performance_Score": 33.3, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Unemployment_Rate": 3.4, "Participation_Rate": 65.3, "Labour_Force": 3387000, "Population": 6681000, "WageIndex": 150.3, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 41.983, "Job_Vacancies": 90772, "Job_Vacancy_Rate": 26.8, "Economic_Performance_Score": 31.1, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"}
        ]
      },
      "transform": [
        {
          "filter": "employmentCategoryFilter == 'All' || datum.Employment_Category == employmentCategoryFilter"
        },
        {
          "filter": "datum.Economic_Performance_Score >= economicScoreSlider"
        },
        {
          "filter": "wageGrowthFilter == 'All' || datum.Wage_Growth_Category == wageGrowthFilter"
        }
      ],
      "layer": [
        {
          "mark": {
            "type": "circle",
            "stroke": "#333333",
            "strokeWidth": 1,
            "opacity": 0.8
          },
          "encoding": {
            "x": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "title": "Employment Rate (%)",
              "scale": {
                "domain": [58, 68],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.3,
                "titleFontSize": 14,
                "labelFontSize": 12
              }
            },
            "y": {
              "field": "WageIndex",
              "type": "quantitative",
              "title": "Wage Index (Base=100)",
              "scale": {
                "domain": [147, 154],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.3,
                "titleFontSize": 14,
                "labelFontSize": 12
              }
            },
            "size": {
              "field": "Job_Vacancies",
              "type": "quantitative",
              "title": "Job Vacancies",
              "scale": {
                "type": "sqrt",
                "range": [200, 800]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 40
              }
            },
            "color": {
              "field": "Economic_Performance_Score",
              "type": "quantitative",
              "title": "Economic Performance",
              "scale": {
                "range": ["#ffe6e6", "#ffb3b3", "#ff8080", "#ff4d4d", "#cc0000"],
                "domain": [30, 65]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 200
              }
            },
            "tooltip": [
              {"field": "State", "type": "nominal", "title": "State/Territory"},
              {"field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)", "format": ".1f"},
              {"field": "WageIndex", "type": "quantitative", "title": "Wage Index", "format": ".1f"},
              {"field": "Job_Vacancies", "type": "quantitative", "title": "Vacancies", "format": ","},
              {"field": "Economic_Performance_Score", "type": "quantitative", "title": "Economic Score", "format": ".1f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 12,
            "dy": 0,
            "fontSize": 10,
            "fontWeight": "bold",
            "color": "#000000"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"},
            "text": {"field": "State_Code", "type": "nominal"}
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "right",
            "baseline": "bottom",
            "dx": -5,
            "dy": -5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Employment Rate"
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            },
            "y": {"value": 490}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "top",
            "dx": 5,
            "dy": 5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Wage Index"
          },
          "encoding": {
            "x": {"value": 10},
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Western Australia'"}],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "bottom",
            "dx": 0,
            "dy": -25,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#d2691e",
            "text": "WA - Highest Wages"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Australian Capital Territory'"}],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "bottom",
            "dx": 15,
            "dy": -15,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#2e8b57",
            "text": "ACT - Highest Employment"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        }
      ],
      "resolve": {
        "scale": {
          "color": "independent",
          "size": "independent"
        }
      },
      "config": {
        "background": "#ffffff",
        "view": {"stroke": "transparent"},
        "font": "Arial, sans-serif"
      }
    }
    </script>

    <script>
        // Load Week 9 Choropleth Map with optimized settings
        const mapSpec = JSON.parse(document.getElementById('week9-map-spec').textContent);
        
        vegaEmbed('#map-vis', mapSpec, {
            theme: 'googlecharts',
            renderer: 'canvas',  // Faster rendering than SVG
            actions: {
                export: false,  // Disable to reduce loading time
                source: false,
                compiled: false,
                editor: false
            },
            padding: {left: 60, right: 40, top: 40, bottom: 60}
        }).then(function(result) {
            console.log('✅ Week 9 choropleth map loaded successfully');
            
            // Optimize view for faster interactions
            result.view.runAfter(function() {
                result.view.hover();  // Enable fast hover
            });
            
        }).catch(function(error) {
            console.error('❌ Error loading Week 9 map:', error);
            document.getElementById('map-vis').innerHTML = 
                '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
                '<h3>⚠️ Map Loading Error</h3>' +
                '<p>Please ensure australia-states.geojson and labour_force_cleaned.csv are available.</p>' +
                '</div>';
        });

        // Load Week 10 Scatter Plot with optimized settings and manual filter controls
        try {
            const scatterSpec = JSON.parse(document.getElementById('week10-scatter-spec').textContent);
            let scatterView = null;
            
            vegaEmbed('#scatter-vis', scatterSpec, {
                theme: 'googlecharts',
                renderer: 'canvas',  // Faster rendering
                actions: {
                    export: false,  // Disable to reduce loading time
                    source: false,
                    compiled: false,
                    editor: false
                },
                padding: {left: 60, right: 40, top: 40, bottom: 60}
            }).then(function(result) {
                console.log('✅ Week 10 scatter plot loaded successfully');
                scatterView = result.view;
                
                // Add manual filter control handlers for GitHub Pages compatibility
                function updateFilters() {
                    const employmentFilter = document.getElementById('employment-filter').value;
                    const wageGrowthFilter = document.getElementById('wage-growth-filter').value;
                    const economicScore = parseInt(document.getElementById('economic-score-slider').value);
                    
                    // Update score display
                    document.getElementById('score-value').textContent = economicScore;
                    
                    // Update Vega-Lite parameters
                    scatterView.signal('employmentCategoryFilter', employmentFilter);
                    scatterView.signal('wageGrowthFilter', wageGrowthFilter);
                    scatterView.signal('economicScoreSlider', economicScore);
                    scatterView.run();
                    
                    console.log('🔧 Filters updated:', {employmentFilter, wageGrowthFilter, economicScore});
                }
                
                // Attach event listeners to manual controls
                document.getElementById('employment-filter').addEventListener('change', updateFilters);
                document.getElementById('wage-growth-filter').addEventListener('change', updateFilters);
                document.getElementById('economic-score-slider').addEventListener('input', updateFilters);
                
                // Optimize view for faster interactions
                result.view.runAfter(function() {
                    result.view.hover();  // Enable fast hover
                });
                
            }).catch(function(error) {
                console.error('❌ Error loading Week 10 scatter plot:', error);
                document.getElementById('scatter-vis').innerHTML = 
                    '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
                    '<h3>⚠️ Scatter Plot Loading Error</h3>' +
                    '<p>Please ensure merged_labour_data.csv is available in the data folder.</p>' +
                    '<p>Error: ' + error.message + '</p>' +
                    '</div>';
            });
        } catch (jsonError) {
            console.error('❌ JSON parsing error:', jsonError);
            document.getElementById('scatter-vis').innerHTML = 
                '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
                '<h3>⚠️ JSON Configuration Error</h3>' +
                '<p>Error parsing scatter plot specification: ' + jsonError.message + '</p>' +
                '</div>';
        }

    </script>
</body>
</html>
