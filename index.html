<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Labour Market Analysis - Week 9 & Week 10</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Georgia:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Georgia', serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header .description {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .content {
            padding: 40px;
        }

        .visualization-section {
            margin-bottom: 50px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            color: #2d3436;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-badge {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }

        .chart-container:hover {
            transform: translateY(-5px);
        }

        .chart-description {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #00b894;
        }

        .chart-description h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .chart-description p {
            color: #636e72;
            margin-bottom: 10px;
        }

    /* Improve readability: limit text width to ~60-70 chars and increase paragraph spacing */
    .description, .chart-description p {
      max-width: 60ch;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.5;
    }
    .lead-story {
      font-size: 1rem;
      color: #334155;
      max-width: 58ch;
      line-height: 1.5;
      margin-top: 0.4rem;
    }

        .features-grid {
            display: grid;
      grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
    /* allow specific cards to span full width (two columns) on desktop */
    .chart-card.full-width { grid-column: 1 / -1; }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #fd79a8;
        }

        .feature-card h4 {
            color: #2d3436;
            margin-bottom: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            color: #636e72;
            font-size: 0.9rem;
        }

        .insights-section {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 40px;
        }

        .insights-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .insight-item h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .data-sources {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .responsive-container {
            width: 100%;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Vega-Lite tooltip styling */
        .vega-tooltip {
            font-family: 'Inter', sans-serif !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            border: 1px solid #ddd !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(10px) !important;
        }

        .vega-tooltip-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 4px !important;
        }

    /* Smooth heatmap fade for filter transitions */
    #heatmap-unemployment-vis { transition: opacity 300ms ease; }

        .vega-tooltip table {
            font-size: 13px !important;
        }

        .vega-tooltip td.key {
            font-weight: 600 !important;
            color: #34495e !important;
            padding-right: 12px !important;
        }

        .vega-tooltip td.value {
            font-weight: 500 !important;
            color: #2c3e50 !important;
        }
    /* Dashboard grid & card refinements for HD layout */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* show 2 per row for demo */
      gap: 24px;
      align-items: start;
      justify-items: center;
    }

    .chart-card, .feature-card {
      background: linear-gradient(180deg, #ffffff 0%, #fbfbfd 100%);
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 12px 30px rgba(17,24,39,0.06);
      transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 360px;
      min-width: 340px;
      border: 1px solid rgba(0,0,0,0.06); /* subtle card border for separation */
    }

    .chart-card:hover, .feature-card:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow: 0 20px 40px rgba(17,24,39,0.12);
    }

    .chart-title {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.6rem;
    }

    .chart-figure {
      flex: 1 1 auto;
      display:block;
      min-height: 240px;
    }

    .chart-annotation {
      margin-top: 0.8rem;
      font-size: 0.95rem;
      color: #475569;
      background: rgba(15,23,42,0.02);
      padding: 0.6rem 0.8rem;
      border-radius: 0.5rem;
    }

    /* fade-in when charts load */
    .chart-loaded { animation: chartFadeIn 420ms ease both; }
    @keyframes chartFadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 1100px) {
      .charts-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 640px) {
      .charts-grid { grid-template-columns: 1fr; }
      .chart-card { padding: 1rem; }
    }
    /* Map hero styles: large centered map area for HD layout */
    .map-hero {
      width: 100%;
      max-width: 1100px;
      min-height: 430px;
      margin: 12px auto;
      border-radius: 1rem;
      box-shadow: 0 18px 40px rgba(17,24,39,0.08);
      overflow: hidden;
      background: #ffffff;
      padding: 8px;
      border: 1px solid rgba(0,0,0,0.04);
      position: relative; /* allow absolute overlay inside */
    }
    /* Smooth SVG transitions and subtle glow on hover for map geoshapes */
    #map-vis svg path {
      transition: stroke-width 180ms ease, stroke 180ms ease, filter 220ms ease, opacity 160ms ease;
    }
    #map-vis svg path:hover {
      filter: drop-shadow(0 6px 12px rgba(60,120,140,0.08));
      stroke-width: 1.6px !important;
      stroke: rgba(33, 37, 41, 0.18) !important; /* much lighter subtle border */
    }
    /* Map overlay annotations placed inside whitespace of card */
    .map-annotations {
      position: absolute;
      bottom: 14px;
      left: 18px;
      background: rgba(255,255,255,0.96);
      padding: 10px 12px;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(17,24,39,0.10);
      font-size: 13px;
      color: #0f172a;
      line-height: 1.28;
      max-width: 42%;
      border: 1px solid rgba(15,23,42,0.04);
      z-index: 40;
    }
    .map-annotations div { margin-bottom: 6px; }
    .map-annot-title { font-weight:700; font-size:14px; margin-bottom:6px; }
    .map-annot-line { font-size:13px; color:#102a43; }
    .map-annot-swatches { display:flex; gap:10px; margin-top:6px; align-items:center; }
    .map-swatch { display:flex; gap:6px; align-items:center; font-size:12px; color:#102a43; }
    .swatch-box { width:14px; height:14px; display:inline-block; border-radius:2px; }
  .swatch-box.high { background: #0b2545; } /* high swatch (deep blue) */
  .swatch-box.medium { background: #41b6c4; } /* medium swatch (teal) */
  .swatch-box.low { background: #d7eef4; } /* low swatch (light blue) */
    @media (max-width: 900px) {
      .map-annotations { max-width: 60%; font-size: 12px; bottom: 12px; left: 12px; }
    }
    @media (max-width: 560px) {
      .map-annotations { position: relative; bottom: auto; left: auto; width: calc(100% - 24px); max-width: none; margin: 12px; }
      .map-hero { padding: 6px; }
      .map-annot-swatches { gap: 8px; }
    }
    </style>
</head>
<body>
    <script>
      // Defensive helpers: some older code expected showLoading/hideLoading globally.
      // These safely no-op if the related DOM elements don't exist to avoid "reading 'style' of null" errors.
      function showLoading(msg) {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return; // gracefully return when missing
          el.style.display = 'block';
          if (msg) el.textContent = msg;
        } catch (e) {
          console.warn('showLoading error (ignored):', e && e.message);
        }
      }

      function hideLoading() {
        try {
          const el = document.getElementById('global-loading');
          if (!el) return;
          el.style.display = 'none';
        } catch (e) {
          console.warn('hideLoading error (ignored):', e && e.message);
        }
      }
    </script>
    <div class="container">
        <div class="header">
            <h1>üá¶üá∫ Australian Labour Market Analysis</h1>
      <div class="subtitle">Comprehensive Spatial and Statistical Visualization</div>
      <div class="description story-intro">
        A concise visual exploration of Australia's labour market ‚Äî where employment is thriving, where it's moderate, and where there's opportunity for growth. Navigate the maps and charts to discover regional patterns and key takeaways.
      </div>
        </div>

    <!-- Global loading indicator used by some scripts (hidden by default) -->
    <div id="global-loading" style="display:none; position: fixed; right: 18px; top: 18px; background: rgba(0,0,0,0.8); color: #fff; padding: 10px 14px; border-radius: 8px; font-size: 0.95rem; z-index: 9999;">Loading‚Ä¶</div>

        <div class="content">
            <!-- Week 9: Choropleth Map Section -->
            <div class="visualization-section">
                <div class="section-header">
                    <div class="section-title">
                        üó∫Ô∏è Geographic Employment Analysis
                    </div>
          <!-- removed week badge per request -->
                </div>

        <div class="chart-description">
          <h3>Interactive Choropleth Map</h3>
          <p class="lead-story">Across Australia's states and territories, employment rates reveal regional patterns ‚Äî some places outperform while others lag. Use the map to explore where employment is strongest and where there's room to grow.</p>
        </div>

                    <div class="chart-container">
                        <div class="responsive-container">
                          <div class="map-hero">
                            <div id="map-vis" style="width:100%; height:100%; min-height:430px;"></div>
                          
                            <!-- overlay annotation box inside map hero (uses whitespace) -->
                            <div class="map-annotations" aria-hidden="false">
                              <div class="map-annot-title">Employment insights</div>
                              <div class="map-annot-line">Highest: ACT ‚Äî 67.2%</div>
                              <div class="map-annot-line">Lowest: SA ‚Äî 59.8%</div>
                              <div class="map-annot-line">Median: ~63%</div>
                              <div class="map-annot-swatches" aria-hidden="true" role="presentation">
                                <div class="map-swatch"><span class="swatch-box high"></span><span class="swatch-label">High</span></div>
                                <div class="map-swatch"><span class="swatch-box medium"></span><span class="swatch-label">Medium</span></div>
                                <div class="map-swatch"><span class="swatch-box low"></span><span class="swatch-label">Low</span></div>
                              </div>
                            </div>
                          </div>
                          </div>
                    </div>
            </div>

            <!-- Week 10: Scatter Plot Section -->
            <div class="visualization-section">
                <div class="section-header">
                    <div class="section-title">
                        üìà Employment-Wage Relationship Analysis
                    </div>
                    <!-- week badge intentionally removed -->
                </div>

                <div class="chart-description">
                    <h3>Multi-Channel Scatter Plot</h3>
                    <p>This advanced visualization explores the relationship between employment rates and wage indices across Australian states. Using position, size, and color encoding, it reveals complex patterns in labour market dynamics and economic performance.</p>
                    <!-- Data sources line removed for cleaner storytelling; file-level README contains provenance -->
                </div>

                <!-- Interactive Filter Controls -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e2e8f0;">
                    <h4 style="margin: 0 0 15px 0; color: #2d3748;">üîß Interactive Filters (Week 10 Requirement)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <label for="employment-filter" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Employment Category:</label>
                            <select id="employment-filter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;">
                                <option value="All">All Categories</option>
                                <option value="Above Average">Above Average</option>
                                <option value="Average">Average</option>
                                <option value="Below Average">Below Average</option>
                            </select>
                        </div>
                        <div>
                            <label for="wage-growth-filter" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Wage Growth Category:</label>
                            <select id="wage-growth-filter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;">
                                <option value="All">All Categories</option>
                                <option value="High Growth">High Growth</option>
                                <option value="Moderate Growth">Moderate Growth</option>
                            </select>
                        </div>
                        <div>
                            <label for="economic-score-slider" style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Min Economic Score: <span id="score-value">30</span></label>
                            <input type="range" id="economic-score-slider" min="30" max="65" step="5" value="30" style="width: 100%;">
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #718096;">
                        üí° Use the controls above to filter the scatter plot data in real-time
                    </div>
                </div>

                <div class="chart-container">
                    <div class="responsive-container">
                        <div id="scatter-vis" style="width: 100%; min-height: 500px;"></div>
                    </div>
        </div>
      </div>

      <!-- Additional Charts Section -->
      <div class="visualization-section">
        <div class="section-header">
          <div class="section-title">üìö Additional Charts</div>
          <div class="week-badge">Supplementary</div>
        </div>

        <div class="chart-description">
          <h3>Supplementary Visualizations</h3>
          <p>The charts below load additional Vega / Vega-Lite specifications from the <code>assets/</code> folder. If a file is missing or the JSON is invalid you'll see a friendly error message in its card.</p>
        </div>

        <div class="chart-container">
          <div class="charts-grid">
            <div class="chart-card">
              <div class="chart-title">Vacancies by Industry</div>
              <div id="vacancies-vis" class="chart-figure"></div>
            <div class="chart-annotation">Summary: Distribution of job vacancies by state.</div>
            </div>

            <div class="chart-card">
              <div class="chart-title">Wage vs Employment Comparison</div>
              <div id="wage-employment-vis" class="chart-figure"></div>
              <div class="chart-annotation">Comparison of wage index vs employment rate by state.</div>
            </div>

            <!-- Bubble chart removed per request -->

            <div class="chart-card full-width">
              <div class="chart-title">Unemployment Heatmap</div>
              <div style="display:flex; gap:12px; align-items:center; margin-bottom:10px;">
                <label style="font-weight:600; font-size:13px;">Period:</label>
                <select id="heatmap-period-select" style="padding:6px; border-radius:6px; border:1px solid #e2e8f0;"></select>
                <label style="font-weight:600; font-size:13px; margin-left:10px;">State:</label>
                <select id="heatmap-state-select" style="padding:6px; border-radius:6px; border:1px solid #e2e8f0;"></select>
              </div>
              <div id="heatmap-unemployment-vis" class="chart-figure"></div>
              <div class="chart-annotation">Summary: Unemployment rate by state and period.</div>
            </div>

            <!-- Stacked by Gender chart removed per request -->

    <!-- Inline specs to avoid fetch/path issues -->
    <script type="application/json" id="vacancies-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Job vacancies by state (inline)",
      "data": { "url": "data/merged_labour_data.csv" },
      "width": 420,
      "height": 320,
      "mark": { "type": "bar", "cornerRadius": 6 },
      "encoding": {
        "x": { "field": "State", "type": "nominal", "sort": "-y", "axis": { "labelAngle": -45 } },
        "y": { "field": "Job_Vacancies", "type": "quantitative", "title": "Job Vacancies" },
        "color": { "field": "Job_Vacancies", "type": "quantitative", "scale": { "range": ["#ffffe0", "#c7e9e4", "#7fb8d6"] }, "legend": null },
        "tooltip": [ { "field": "State", "type": "nominal" }, { "field": "Job_Vacancies", "type": "quantitative", "format": "," } ]
      }
    }
    </script>

    <!-- Bubble inline spec removed per request -->
    
  <script>
    // Dynamically load and embed selected Vega(-Lite) JSON specs after DOM is ready.
    (function() {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM ready ‚Äî starting chart embedding');

        // Target charts to embed for verification
        // For vacancies and bubble we prefer inline specs (specId) to avoid fetch/path issues
        const chartsToLoad = [
          {id: 'wage-employment-vis', file: './assets/wage_vs_employment.json'},
          {id: 'vacancies-vis', specId: 'vacancies-spec'},
          {id: 'heatmap-unemployment-vis', file: './assets/heatmap_unemployment_v2.json'}
        ];

        chartsToLoad.forEach(function(chart) {
          console.log('Attempting to load', chart.file || ('inline spec ' + chart.specId), 'into', chart.id);
          embedChart(chart);
        });

        function embedChart(chart) {
          const id = chart.id;
          const container = document.getElementById(id);
          if (!container) {
            console.warn('Container not found for', id);
            return;
          }

          // If inline spec provided, use it
          if (chart.specId) {
            try {
              const scriptEl = document.getElementById(chart.specId);
              if (!scriptEl) throw new Error('Inline spec element not found: ' + chart.specId);
              const jsonText = scriptEl.textContent.trim();
              if (!jsonText) throw new Error('Inline spec is empty: ' + chart.specId);
              const spec = JSON.parse(jsonText);
              console.log('Parsed inline spec', chart.specId, ' ‚Äî embedding now');
              vegaEmbed('#' + id, spec, { theme: 'googlecharts', renderer: 'canvas', actions: {export: false, source: false, compiled: false, editor: false}, padding: {left:18, right:18, top:18, bottom:18} })
                .then(function(result) { document.getElementById(id).classList.add('chart-loaded'); try { document.getElementById(id).__vega_view = result.view; } catch(e){} console.log('‚úÖ Embedded inline', chart.specId, 'into', id); })
                .catch(function(err) { container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>‚ö†Ô∏è Error embedding inline spec:</strong> '+err.message+'</div>'; console.error('Embed error for inline', chart.specId, err); });
              return;
            } catch (err) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>‚ö†Ô∏è Inline spec error:</strong> '+err.message+'</div>';
              console.warn('Inline spec error for', chart.specId, err);
              return;
            }
          }

          // Otherwise fetch the JSON spec
          const file = chart.file;
          fetch(file).then(function(resp) {
            if (!resp.ok) throw new Error('HTTP ' + resp.status + ' ' + resp.statusText);
            const ct = resp.headers.get('content-type') || '';
            // If the server returned HTML (e.g. an error page or redirected HTML), fail fast with useful message
            if (ct.indexOf('text/html') !== -1) throw new Error('Unexpected HTML response (Content-Type: ' + ct + '). The file path may be wrong or GitHub Pages served an error page.');
            return resp.text();
          }).then(function(text) {
            const trimmed = text.trim();
            console.debug('Fetched', file, 'length:', trimmed.length, 'sample:', trimmed.slice(0,200));
            if (!trimmed) throw new Error('Empty file');

            // attempt to extract JSON from HTML wrappers (some assets were wrapped in <script> blocks)
            let jsonText = trimmed;
            const scriptMatch = trimmed.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
            if (scriptMatch) jsonText = scriptMatch[1];

            let spec;
            try {
              spec = JSON.parse(jsonText);
            } catch (err) {
              // Provide a clearer error when the text begins with '<' which commonly indicates HTML
              if (jsonText.trim().charAt(0) === '<') {
                throw new Error('Invalid JSON: file appears to contain HTML/markup. This often happens if the asset path is wrong or GitHub Pages returned an HTML error page.');
              }
              // Try to pull JSON out of an application/json script block if present
              const jsonBlockMatch = trimmed.match(/<script[^>]+type="application\/json"[^>]*>([\s\S]*?)<\/script>/i);
              if (jsonBlockMatch) {
                try { spec = JSON.parse(jsonBlockMatch[1]); }
                catch (innerErr) { throw innerErr; }
              } else {
                throw err; // rethrow original JSON parse error
              }
            }

            console.log('Parsed spec for', file, ' ‚Äî embedding now');

            vegaEmbed('#' + id, spec, {
              theme: 'googlecharts', renderer: 'canvas',
              actions: {export: false, source: false, compiled: false, editor: false},
              padding: {left:18, right:18, top:18, bottom:18}
            }).then(function(result) {
              // Add loaded class for animation
              const el = document.getElementById(id);
              if (el) { el.classList.add('chart-loaded'); try { el.__vega_view = result.view; } catch(e){} }
              console.log('‚úÖ Embedded', file, 'into', id);
            }).catch(function(embedErr) {
              container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>‚ö†Ô∏è Error embedding:</strong> '+embedErr.message+'</div>';
              console.error('Embed error for', file, embedErr);
            });

          }).catch(function(fetchErr) {
            container.innerHTML = '<div style="color:#e74c3c; padding:18px;"><strong>‚ö†Ô∏è Could not load chart file:</strong> '+fetchErr.message+'</div>';
            console.warn('Could not load', file, fetchErr);
          });
        }
      });
    })();
  </script>

    <script type="application/json" id="week10-scatter-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Employment Rate vs Wage Index Analysis",
        "subtitle": "Multi-channel encoding: Position (Employment vs Wages), Size (Job Vacancies), Color (Economic Performance) | Use filters below to explore data",
        "fontSize": 16,
        "subtitleFontSize": 12,
        "color": "#000000",
        "subtitleColor": "#333333",
        "anchor": "start"
      },
      "params": [
        {
          "name": "employmentCategoryFilter",
          "bind": {
            "input": "select",
            "options": ["All", "Above Average", "Average", "Below Average"],
            "name": "Employment Category Filter: "
          },
          "value": "All"
        },
        {
          "name": "economicScoreSlider",
          "bind": {
            "input": "range",
            "min": 30,
            "max": 65,
            "step": 5,
            "name": "Minimum Economic Performance Score: "
          },
          "value": 30
        },
        {
          "name": "wageGrowthFilter",
          "bind": {
            "input": "select",
            "options": ["All", "High Growth", "Moderate Growth"],
            "name": "Wage Growth Category Filter: "
          },
          "value": "All"
        }
      ],
      "width": 800,
      "height": 500,
      "data": {
        "values": [
          {"State": "Queensland", "State_Code": "QLD", "Employment_Rate": 61.9, "Unemployment_Rate": 4.1, "Participation_Rate": 64.5, "Labour_Force": 2618000, "Population": 5156000, "WageIndex": 149.5, "WageGrowthRate": 2.48, "Employment_to_Wage_Ratio": 41.405, "Job_Vacancies": 63356, "Job_Vacancy_Rate": 24.2, "Economic_Performance_Score": 62.6, "Employment_Category": "Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Australian Capital Territory", "State_Code": "ACT", "Employment_Rate": 67.2, "Unemployment_Rate": 2.8, "Participation_Rate": 69.1, "Labour_Force": 230000, "Population": 431000, "WageIndex": 152.9, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 43.95, "Job_Vacancies": 7291, "Job_Vacancy_Rate": 31.7, "Economic_Performance_Score": 60.0, "Employment_Category": "Above Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "South Australia", "State_Code": "SA", "Employment_Rate": 59.8, "Unemployment_Rate": 4.3, "Participation_Rate": 62.5, "Labour_Force": 864000, "Population": 1771000, "WageIndex": 148.2, "WageGrowthRate": 2.45, "Employment_to_Wage_Ratio": 40.351, "Job_Vacancies": 18490, "Job_Vacancy_Rate": 21.4, "Economic_Performance_Score": 44.5, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Western Australia", "State_Code": "WA", "Employment_Rate": 63.4, "Unemployment_Rate": 3.0, "Participation_Rate": 65.3, "Labour_Force": 1391000, "Population": 2667000, "WageIndex": 153.7, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.249, "Job_Vacancies": 44651, "Job_Vacancy_Rate": 32.1, "Economic_Performance_Score": 37.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Northern Territory", "State_Code": "NT", "Employment_Rate": 63.1, "Unemployment_Rate": 3.7, "Participation_Rate": 65.5, "Labour_Force": 134000, "Population": 249000, "WageIndex": 152.4, "WageGrowthRate": 2.16, "Employment_to_Wage_Ratio": 41.404, "Job_Vacancies": 3926, "Job_Vacancy_Rate": 29.3, "Economic_Performance_Score": 36.5, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Tasmania", "State_Code": "TAS", "Employment_Rate": 58.7, "Unemployment_Rate": 3.9, "Participation_Rate": 61.1, "Labour_Force": 276000, "Population": 542000, "WageIndex": 147.6, "WageGrowthRate": 2.43, "Employment_to_Wage_Ratio": 39.77, "Job_Vacancies": 5465, "Job_Vacancy_Rate": 19.8, "Economic_Performance_Score": 34.6, "Employment_Category": "Below Average", "Wage_Growth_Category": "High Growth", "Year_Quarter": "2025-Q3"},
          {"State": "New South Wales", "State_Code": "NSW", "Employment_Rate": 62.8, "Unemployment_Rate": 3.2, "Participation_Rate": 65.0, "Labour_Force": 4105000, "Population": 8166000, "WageIndex": 150.8, "WageGrowthRate": 2.15, "Employment_to_Wage_Ratio": 41.645, "Job_Vacancies": 116992, "Job_Vacancy_Rate": 28.5, "Economic_Performance_Score": 33.3, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"},
          {"State": "Victoria", "State_Code": "VIC", "Employment_Rate": 63.1, "Unemployment_Rate": 3.4, "Participation_Rate": 65.3, "Labour_Force": 3387000, "Population": 6681000, "WageIndex": 150.3, "WageGrowthRate": 2.11, "Employment_to_Wage_Ratio": 41.983, "Job_Vacancies": 90772, "Job_Vacancy_Rate": 26.8, "Economic_Performance_Score": 31.1, "Employment_Category": "Average", "Wage_Growth_Category": "Moderate Growth", "Year_Quarter": "2025-Q3"}
        ]
      },
      "transform": [
        {
          "filter": "employmentCategoryFilter == 'All' || datum.Employment_Category == employmentCategoryFilter"
        },
        {
          "filter": "datum.Economic_Performance_Score >= economicScoreSlider"
        },
        {
          "filter": "wageGrowthFilter == 'All' || datum.Wage_Growth_Category == wageGrowthFilter"
        }
      ],
      "layer": [
        {
            "mark": {
            "type": "circle",
            "stroke": "#6b7280",
            "strokeWidth": 1,
            "opacity": 0.8
          },
          "encoding": {
            "x": {
              "field": "Employment_Rate",
              "type": "quantitative",
              "title": "Employment Rate (%)",
              "scale": {
                "domain": [58, 68],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.3,
                "titleFontSize": 14,
                "labelFontSize": 12
              }
            },
            "y": {
              "field": "WageIndex",
              "type": "quantitative",
              "title": "Wage Index (Base=100)",
              "scale": {
                "domain": [147, 154],
                "nice": true
              },
              "axis": {
                "grid": true,
                "gridOpacity": 0.3,
                "titleFontSize": 14,
                "labelFontSize": 12
              }
            },
            "size": {
              "field": "Job_Vacancies",
              "type": "quantitative",
              "title": "Job Vacancies",
              "scale": {
                "type": "sqrt",
                "range": [200, 800]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 40
              }
            },
              "color": {
              "field": "Economic_Performance_Score",
              "type": "quantitative",
              "title": "Economic Performance",
              "scale": {
                "range": ["#ffffe0", "#ffd27f", "#c7e9e4", "#7fb8d6", "#b8d6f2"],
                "domain": [30, 65]
              },
              "legend": {
                "orient": "right",
                "titleFontSize": 12,
                "labelFontSize": 10,
                "offset": 200
              }
            },
            "tooltip": [
              {"field": "State", "type": "nominal", "title": "State/Territory"},
              {"field": "Employment_Rate", "type": "quantitative", "title": "Employment Rate (%)", "format": ".1f"},
              {"field": "WageIndex", "type": "quantitative", "title": "Wage Index", "format": ".1f"},
              {"field": "Job_Vacancies", "type": "quantitative", "title": "Vacancies", "format": ","},
              {"field": "Economic_Performance_Score", "type": "quantitative", "title": "Economic Score", "format": ".1f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 12,
            "dy": 0,
            "fontSize": 10,
            "fontWeight": "bold",
            "color": "#000000"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"},
            "text": {"field": "State_Code", "type": "nominal"}
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "#999999",
            "strokeDash": [3, 3],
            "opacity": 0.5
          },
          "encoding": {
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "right",
            "baseline": "bottom",
            "dx": -5,
            "dy": -5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Employment Rate"
          },
          "encoding": {
            "x": {
              "aggregate": "mean",
              "field": "Employment_Rate",
              "type": "quantitative"
            },
            "y": {"value": 490}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "top",
            "dx": 5,
            "dy": 5,
            "fontSize": 9,
            "color": "#666666",
            "text": "National Average Wage Index"
          },
          "encoding": {
            "x": {"value": 10},
            "y": {
              "aggregate": "mean",
              "field": "WageIndex",
              "type": "quantitative"
            }
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Western Australia'"}],
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "bottom",
            "dx": 0,
            "dy": -25,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#d2691e",
            "text": "WA - Highest Wages"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        },
        {
          "transform": [{"filter": "datum.State == 'Australian Capital Territory'"}],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "bottom",
            "dx": 15,
            "dy": -15,
            "fontSize": 11,
            "fontWeight": "bold",
            "color": "#2e8b57",
            "text": "ACT - Highest Employment"
          },
          "encoding": {
            "x": {"field": "Employment_Rate", "type": "quantitative"},
            "y": {"field": "WageIndex", "type": "quantitative"}
          }
        }
      ],
      "resolve": {
        "scale": {
          "color": "independent",
          "size": "independent"
        }
      },
      "config": {
        "background": "#ffffff",
        "view": {"stroke": "transparent"},
        "font": "Arial, sans-serif"
      }
    }
    </script>
    <script type="application/json" id="week9-map-spec">
    {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Australian Employment Rates by State/Territory",
  "width": "container",
  "height": 430,
      "autosize": { "type": "fit", "contains": "padding" },
      "projection": { "type": "conicEqualArea", "parallels": [-18, -36], "rotate": [-132,0], "center": [0,-28], "scale": 700 },
      "data": { "url": "assets/australia-states.geojson", "format": { "type": "json", "property": "features" } },
      "transform": [
        {
          "lookup": "properties.STATE_NAME",
          "from": {
            "data": {
              "values": [
                {"State": "Queensland","State_Code":"QLD","Employment_Rate":61.9,"Labour_Force":2618000},
                {"State": "Australian Capital Territory","State_Code":"ACT","Employment_Rate":67.2,"Labour_Force":230000},
                {"State": "South Australia","State_Code":"SA","Employment_Rate":59.8,"Labour_Force":864000},
                {"State": "Western Australia","State_Code":"WA","Employment_Rate":63.4,"Labour_Force":1391000},
                {"State": "Northern Territory","State_Code":"NT","Employment_Rate":63.1,"Labour_Force":134000},
                {"State": "Tasmania","State_Code":"TAS","Employment_Rate":58.7,"Labour_Force":276000},
                {"State": "New South Wales","State_Code":"NSW","Employment_Rate":62.8,"Labour_Force":4105000},
                {"State": "Victoria","State_Code":"VIC","Employment_Rate":63.1,"Labour_Force":3387000}
              ]
            },
            "key": "State",
            "fields": ["Employment_Rate","Labour_Force","State_Code"]
          }
        }
        ,
        {
          "calculate": "datum.Employment_Rate >= 66 ? 'High' : datum.Employment_Rate <= 60 ? 'Low' : 'Medium'",
          "as": "Employment_Level"
        }
      ],
  "mark": { "type": "geoshape", "stroke": "rgba(255,255,255,0.9)", "strokeWidth": 0.9 },
      "params": [
        { "name": "hoverState", "select": { "type": "point", "on": "mouseover", "clear": "mouseout" } }
      ],
        "encoding": {
          "color": { "field": "Employment_Rate", "type": "quantitative", "scale": { "range": ["#d7eef4", "#7fb8d6", "#0b2545"], "domain": [58,68] }, "legend": { "title": "Employment Rate (%) ‚Äî Low ‚Üí High", "orient": "left", "tickMinStep": 1, "values": [58,62,66,68], "format": ".0f", "offset": 10 } },
          "stroke": { "condition": { "param": "hoverState", "value": "rgba(33,37,41,0.22)" }, "value": "rgba(255,255,255,0.9)" },
          "strokeWidth": { "condition": { "param": "hoverState", "value": 2 }, "value": 0.9 },
          "opacity": { "condition": { "param": "hoverState", "value": 1 }, "value": 0.95 },
          "tooltip": [ { "field": "properties.STATE_NAME", "type": "nominal", "title": "State" }, { "field": "Employment_Rate", "type": "quantitative", "title": "Employment (%)", "format": ".1f" }, { "field": "Labour_Force", "type": "quantitative", "title": "Labour", "format": ",.0f" }, { "field": "Employment_Level", "type": "nominal", "title": "Level" } ]
        },
      "config": { "view": { "stroke": "transparent" }, "background": "#f8fafc" }
    }
    </script>

    <script>
    // Load Week 9 Choropleth Map with optimized settings
    (function loadMapSafely() {
      const mapScriptEl = document.getElementById('week9-map-spec');
      if (!mapScriptEl) {
        console.warn('week9-map-spec element not found ‚Äî skipping map embed (check that the inline spec exists and has id="week9-map-spec")');
        return;
      }
      let mapSpec = null;
      try {
        mapSpec = JSON.parse(mapScriptEl.textContent);
      } catch (e) {
        console.error('Could not parse week9-map-spec JSON:', e);
        document.getElementById('map-vis').innerHTML = '<div style="text-align:center;padding:30px;color:#e74c3c;"><strong>‚ö†Ô∏è Invalid map specification:</strong> '+e.message+'</div>';
        return;
      }

  vegaEmbed('#map-vis', mapSpec, {
    theme: 'googlecharts',
    renderer: 'svg',  // Use SVG for crisper hover/stroke transitions
            actions: {
                export: false,  // Disable to reduce loading time
                source: false,
                compiled: false,
                editor: false
            },
  padding: {left: 70, right: 8, top: 8, bottom: 8}
        }).then(function(result) {
            console.log('‚úÖ Week 9 choropleth map loaded successfully');
            
            // Optimize view for faster interactions
            result.view.runAfter(function() {
                result.view.hover();  // Enable fast hover
            });
            
        }).catch(function(error) {
            console.error('‚ùå Error loading Week 9 map:', error);
            document.getElementById('map-vis').innerHTML = 
                '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
                '<h3>‚ö†Ô∏è Map Loading Error</h3>' +
                '<p>Please ensure australia-states.geojson and labour_force_cleaned.csv are available.</p>' +
                '</div>';
        });
})();

  // Load Week 10 Scatter Plot with optimized settings and manual filter controls
    (function loadScatterSafely() {
      const scatterScriptEl = document.getElementById('week10-scatter-spec');
      if (!scatterScriptEl) {
        console.warn('week10-scatter-spec element not found ‚Äî skipping scatter embed (check that the inline spec exists and has id="week10-scatter-spec")');
        return;
      }
      let scatterSpec = null;
      try {
        scatterSpec = JSON.parse(scatterScriptEl.textContent);
      } catch (jsonError) {
        console.error('‚ùå JSON parsing error for week10-scatter-spec:', jsonError);
        document.getElementById('scatter-vis').innerHTML = '<div style="text-align:center;padding:30px;color:#e74c3c;"><strong>‚ö†Ô∏è JSON Configuration Error:</strong> '+jsonError.message+'</div>';
        return;
      }
      let scatterView = null;

      vegaEmbed('#scatter-vis', scatterSpec, {
                theme: 'googlecharts',
                renderer: 'canvas',  // Faster rendering
                actions: {
                    export: false,  // Disable to reduce loading time
                    source: false,
                    compiled: false,
                    editor: false
                },
                padding: {left: 60, right: 40, top: 40, bottom: 60}
            }).then(function(result) {
                console.log('‚úÖ Week 10 scatter plot loaded successfully');
                scatterView = result.view;
                
                // Add manual filter control handlers for GitHub Pages compatibility
                function updateFilters() {
                    const employmentFilter = document.getElementById('employment-filter').value;
                    const wageGrowthFilter = document.getElementById('wage-growth-filter').value;
                    const economicScore = parseInt(document.getElementById('economic-score-slider').value);
                    
                    // Update score display
                    document.getElementById('score-value').textContent = economicScore;
                    
                    // Update Vega-Lite parameters
                    scatterView.signal('employmentCategoryFilter', employmentFilter);
                    scatterView.signal('wageGrowthFilter', wageGrowthFilter);
                    scatterView.signal('economicScoreSlider', economicScore);
                    scatterView.run();
                    
                    console.log('üîß Filters updated:', {employmentFilter, wageGrowthFilter, economicScore});
                }
                
                // Attach event listeners to manual controls
                document.getElementById('employment-filter').addEventListener('change', updateFilters);
                document.getElementById('wage-growth-filter').addEventListener('change', updateFilters);
                document.getElementById('economic-score-slider').addEventListener('input', updateFilters);
                
                // Optimize view for faster interactions
                result.view.runAfter(function() {
                    result.view.hover();  // Enable fast hover
                });
                
      }).catch(function(error) {
        console.error('‚ùå Error loading Week 10 scatter plot:', error);
        document.getElementById('scatter-vis').innerHTML = 
          '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
          '<h3>‚ö†Ô∏è Scatter Plot Loading Error</h3>' +
          '<p>Please ensure merged_labour_data.csv is available in the data folder.</p>' +
          '<p>Error: ' + error.message + '</p>' +
          '</div>';
      });

    })();

    // Heatmap controls: populate selects and wire to Vega view
    (function wireHeatmapControls() {
      const periodSelect = document.getElementById('heatmap-period-select');
      const stateSelect = document.getElementById('heatmap-state-select');
      const heatmapId = 'heatmap-unemployment-vis';
      let heatmapView = null;

      // Populate selects by reading the CSV once and deriving unique values
      const states = ['All','Australian Capital Territory','New South Wales','Northern Territory','Queensland','South Australia','Tasmania','Victoria','Western Australia'];
      states.forEach(s => { const o = document.createElement('option'); o.value = s; o.text = s; stateSelect.appendChild(o); });

      // Fetch CSV to derive period options (fast, client-side parse)
      (function populatePeriods() {
        fetch('data/merged_labour_data.csv').then(r => r.text()).then(text => {
          try {
            const rows = text.split(/\r?\n/).filter(Boolean);
            const header = rows.shift().split(',').map(h=>h.trim());
            const idx = header.indexOf('Year_Quarter');
            if (idx < 0) {
              // fallback
              const o = document.createElement('option'); o.value = 'All'; o.text = 'All'; periodSelect.appendChild(o);
              return;
            }
            const set = new Set();
            rows.forEach(r => {
              const cols = r.split(',');
              if (cols.length > idx) set.add(cols[idx].trim());
            });
            const periods = ['All', ...Array.from(set).sort()];
            periods.forEach(p => { const o = document.createElement('option'); o.value = p; o.text = p; periodSelect.appendChild(o); });
          } catch (e) {
            const o = document.createElement('option'); o.value = 'All'; o.text = 'All'; periodSelect.appendChild(o);
          }
        }).catch(err => {
          const o = document.createElement('option'); o.value = 'All'; o.text = 'All'; periodSelect.appendChild(o);
        });
      })();

      // Wait for the embedded spec to be available
      function findHeatmapView() {
        try {
          if (!window.vegaEmbed) return;
          // try to read vega view attached to the container
          const container = document.getElementById(heatmapId);
          if (!container) return null;
          // vegaEmbed stores view on the container's _vega_view or inside the embed promise result; check both
          if (container.__vega_view) return container.__vega_view;
          // Scan global vegaEmbed results (not available reliably). As fallback, use setTimeout to retry
          return null;
        } catch (e) { return null; }
      }

      function applyFilters() {
        if (!heatmapView) return;
        const period = periodSelect.value;
        const state = stateSelect.value;
        const container = document.getElementById(heatmapId);
        // fade-out, update signals, fade-in
        container.style.pointerEvents = 'none';
        container.style.opacity = '0.25';
        // set signals then run
        heatmapView.signal('periodFilter', period).signal('stateFilter', state).runAsync().then(() => {
          // small delay for perceived smoothness
          setTimeout(() => { container.style.opacity = '1'; container.style.pointerEvents = 'auto'; }, 220);
        }).catch(err => {
          // fallback: restore UI
          container.style.opacity = '1'; container.style.pointerEvents = 'auto';
          console.warn('Heatmap filter update failed:', err);
        });
      }

      // Poll for the embedded view (vegaEmbed attaches view asynchronously)
      const poll = setInterval(function() {
        // vegaEmbed stores the view result on the DOM node in some builds as '__vega_view' or '__vegaembed'
        const el = document.getElementById(heatmapId);
        if (!el) return;
        // check common places
        if (el.__vega_view) { heatmapView = el.__vega_view; clearInterval(poll); }
        else if (el.__vegaembed && el.__vegaembed.view) { heatmapView = el.__vegaembed.view; clearInterval(poll); }
        else {
          // try to inspect embed (vega-embed attaches a child with class 'vega-embed')
          const embedDiv = el.querySelector('.vega-embed');
          if (embedDiv && embedDiv.__vega_view) { heatmapView = embedDiv.__vega_view; clearInterval(poll); }
        }

        if (heatmapView) {
          // attach listeners
          periodSelect.addEventListener('change', applyFilters);
          stateSelect.addEventListener('change', applyFilters);
        }
      }, 300);

    })();

    </script>
</body>
</html>
